import{s as F}from"./statutInfos-Dl5tZIw7.js";import{P as we,_ as Oe}from"./printRamassage-SpAmi3-r.js";import{_ as xe}from"./DialogCloseBtn-jFeUjWIh.js";import{V as he,_ as De,c as Ue}from"./VDataTableServer-BI-ePvWH.js";import{d as Pe,_ as $e,a as h,b as M,e as H,c as Le}from"./constants-nDrBSXdr.js";import{_ as Be}from"./AppTextField-CjMF6sBU.js";import{_ as Ae}from"./AppSelect-Cx4sYSc0.js";import{_ as Fe}from"./AppAutocomplete-DFFAMqsh.js";import{r as n,A as D,aq as K,w as Me,j as Re,Y,a as Ee,c as J,o as i,b as l,f as d,m as v,e as o,d as Q,n as t,ak as r,v as y,x as R,s as X,ai as U,$ as Ne}from"./index-Cn4GOq09.js";import{$ as E}from"./VForm-B-RrgLOX.js";import{t as Z}from"./toast-Cs2lwIGd.js";import{u as je}from"./index-DbX47XIY.js";import{V as ee}from"./VCardText-oDAfMypB.js";import{V as te,a as _}from"./VRow-_eMtTXOa.js";import{a as ae,V as We}from"./VList-COcPg8cx.js";import{V as le}from"./VDivider-CSx1XzIQ.js";import{V as qe}from"./VSpacer-BVxtiIgt.js";import{V as Ge}from"./VMenu-ClR026Z9.js";import{V as ze}from"./VChip-DvpeVEqC.js";import{V as He}from"./VDialog-C1fNNfVN.js";import{V as se}from"./VCard-C8xyqS8Y.js";import{s as Ke}from"./VTabs-BXNaAe7P.js";import"./AppTextarea-CUdfnPlM.js";import"./VInput-DnGVuAhw.js";import"./VImg-BcxKOzCh.js";import"./forwardRefs-DWGaNmQL.js";import"./VAlert-6CETvwmv.js";import"./VAvatar-CUGtIZAw.js";import"./VDataTable-BcoK-fRS.js";import"./VSelect-DOHcxXJU.js";import"./VTextField-Cf1CINQn.js";import"./VOverlay-BZZDccpP.js";import"./VSelectionControl-CxcP7L5m.js";import"./filter-FvdvvAwW.js";import"./VNodeRenderer-BvAAXyPw.js";import"./qrcode.vue.esm-Biyerob7.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css              */const Ye={class:"d-flex flex-wrap gap-4 ma-6"},Je={class:"d-flex gap-4 flex-wrap align-center"},Qe={key:1},Mt={__name:"index",props:{statut:{type:String,required:!0}},async setup(oe){let p,S;const ne=oe,P=n(!1),re=n([{title:"Aujourd'hui",value:"today"},{title:"Hier",value:"yesterday"},{title:"La semaine dernière",value:"lastWeek"},{title:"Ce mois",value:"thisMonth"},{title:"Le mois précédent",value:"lastMonth"},{title:"Personnalisé",value:"custom"}]),ie=D("gestionnaire","action"),u=n(),m=n(),k=n("today"),N=()=>{const s=new Date;switch(P.value=k.value==="custom",k.value){case"today":u.value=s.toISOString().split("T")[0],m.value=s.toISOString().split("T")[0];break;case"yesterday":const e=h(s,-1);u.value=e.toISOString().split("T")[0],m.value=e.toISOString().split("T")[0];break;case"lastWeek":u.value=Ke(h(s,-7)).toISOString().split("T")[0],m.value=Le(h(s,-7)).toISOString().split("T")[0];break;case"thisMonth":u.value=M(s).toISOString().split("T")[0],m.value=H(s).toISOString().split("T")[0];break;case"lastMonth":const V=h(M(s),-1);u.value=M(V).toISOString().split("T")[0],m.value=H(V).toISOString().split("T")[0];break}};N();const I=n(),ue=([p,S]=K(()=>E("/api/ramasseurs").then(s=>s.data)),p=await p,S(),p),me=[{title:"code",key:"code",sortable:!1},{title:"Statut",key:"statut",sortable:!1},{title:"Livreur",key:"livreur",sortable:!1},{title:"Montant encaisse",key:"montant_encaisse",sortable:!1},{title:"Montant facturée",key:"montant_facture",sortable:!1},{title:"Frais Total",key:"frais_total",sortable:!1}],C=n(),b=n(),T=n(!1),c=n(!1),$=n(),w=n(!1),de=n(),f=n(5),g=n(1),j=n(),W=n();Me(()=>ne.statut,s=>{b.value=s},{immediate:!0});const pe=s=>{c.value=!0,$.value=s},ce=async()=>{let s="/api/ramassage/"+$.value.id;T.value=!0,E({method:"DELETE",url:s}).then(async e=>{e.status===200&&(c.value=!1,Z.success(e.data),L()),T.value=!1}).catch(e=>{T.value=!1})},O=n(!1),fe=async()=>{let s="/api/generateLivreurFactures";O.value=!0,E({method:"POST",url:s}).then(async e=>{e.status===200&&(Z.success(e.data),L()),O.value=!1}).catch(e=>{O.value=!1})},ve=s=>{var e,V;j.value=(e=s.sortBy[0])==null?void 0:e.key,W.value=(V=s.sortBy[0])==null?void 0:V.order},{data:q,error:Xe,statusCode:Ze,isFetching:ge,execute:L}=([p,S]=K(()=>je(Ue("/api/factureLivreur",{query:{livreur_id:I,begin_date:u,end_date:m,code:C,statut:b,page:g,itemsPerPage:f,sortBy:j,orderBy:W}}))),p=await p,S(),p),Ve=Re(),ye=Y(()=>q.value.items),G=Y(()=>q.value.total),x=n(!1),_e=n(0),ke=n(0);return(s,e)=>{const V=Fe,B=Ae,be=Be,z=$e,Se=Ee("IconBtn"),Ie=De,Ce=xe,Te=Oe;return i(),J("div",null,[l(se,{title:"Filtres",class:"mb-6 d-print-none"},{default:o(()=>[l(ee,null,{default:o(()=>[l(te,null,{default:o(()=>[t(ie)?(i(),d(_,{key:0,cols:"12",sm:"3"},{default:o(()=>[l(V,{modelValue:t(I),"onUpdate:modelValue":e[0]||(e[0]=a=>r(I)?I.value=a:null),placeholder:"Livreurs",items:t(ue),clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1})):v("",!0),l(_,{cols:"12",sm:"3"},{default:o(()=>[l(B,{modelValue:t(b),"onUpdate:modelValue":e[1]||(e[1]=a=>r(b)?b.value=a:null),placeholder:"Statut",items:t(Pe),clearable:"","clear-icon":"tabler-x"},{item:o(({item:a,props:A})=>[l(ae,X(A,{title:("statutInfos"in s?s.statutInfos:t(F))(a.value).text}),null,16,["title"])]),selection:o(({item:a})=>[y(R(("statutInfos"in s?s.statutInfos:t(F))(a.value).text),1)]),_:1},8,["modelValue","items"])]),_:1}),l(_,{cols:"12",sm:"2"},{default:o(()=>[l(be,{modelValue:t(C),"onUpdate:modelValue":e[2]||(e[2]=a=>r(C)?C.value=a:null),placeholder:"Code"},null,8,["modelValue"])]),_:1})]),_:1}),l(te,null,{default:o(()=>[l(_,{cols:"12",sm:"3"},{default:o(()=>[l(B,{modelValue:t(k),"onUpdate:modelValue":[e[3]||(e[3]=a=>r(k)?k.value=a:null),N],placeholder:"Plage de dates",items:t(re),label:t(u)+" - "+t(m)},null,8,["modelValue","items","label"])]),_:1}),t(P)?(i(),d(_,{key:0,cols:"12",sm:"3"},{default:o(()=>[l(z,{modelValue:t(u),"onUpdate:modelValue":e[4]||(e[4]=a=>r(u)?u.value=a:null),label:"Début",placeholder:"date"},null,8,["modelValue"])]),_:1})):v("",!0),t(P)?(i(),d(_,{key:1,cols:"12",sm:"3"},{default:o(()=>[l(z,{modelValue:t(m),"onUpdate:modelValue":e[5]||(e[5]=a=>r(m)?m.value=a:null),label:"Fin",placeholder:"date"},null,8,["modelValue"])]),_:1})):v("",!0)]),_:1})]),_:1}),l(le),Q("div",Ye,[l(qe),Q("div",Je,[l(B,{modelValue:t(f),"onUpdate:modelValue":e[6]||(e[6]=a=>r(f)?f.value=a:null),items:[5,10,20,25,50]},null,8,["modelValue"]),t(D)("create","factureLivreur")?(i(),d(U,{key:0,color:"primary","prepend-icon":"tabler-plus",loading:t(O),onClick:fe},{default:o(()=>e[15]||(e[15]=[y(" Génerer les factures ")])),_:1},8,["loading"])):v("",!0)])]),l(le,{class:"mt-4"}),l(he,{"items-per-page":t(f),"onUpdate:itemsPerPage":e[8]||(e[8]=a=>r(f)?f.value=a:null),page:t(g),"onUpdate:page":e[9]||(e[9]=a=>r(g)?g.value=a:null),loading:t(ge),headers:me,items:t(ye),"items-length":t(G),class:"text-no-wrap",locale:"fr","onUpdate:options":ve},{"item.code":o(({item:a})=>[t(D)("show","factureLivreur")?(i(),d(U,{key:0,variant:"text",onClick:A=>t(Ve).push("/factureLivreur/"+a.id)},{default:o(()=>[y(R(a.code),1)]),_:2},1032,["onClick"])):(i(),J("span",Qe,R(a.code),1))]),"item.statut":o(({item:a})=>[l(ze,X(("statutInfos"in s?s.statutInfos:t(F))(a.statut),{density:"default",label:"",size:"small"}),null,16)]),"item.actions":o(({item:a})=>[a.statut=="EN_ATTENTE"?(i(),d(Se,{key:0},{default:o(()=>[l(Ne,{icon:"tabler-dots-vertical"}),l(Ge,{activator:"parent"},{default:o(()=>[l(We,null,{default:o(()=>[t(D)("delete","ramassage")?(i(),d(ae,{key:0,value:"delete","prepend-icon":"tabler-trash",onClick:A=>pe(a)},{default:o(()=>e[16]||(e[16]=[y(" Delete ")])),_:2},1032,["onClick"])):v("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)):v("",!0)]),bottom:o(()=>[l(Ie,{page:t(g),"onUpdate:page":e[7]||(e[7]=a=>r(g)?g.value=a:null),"items-per-page":t(f),"total-items":t(G)},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","page","loading","items","items-length"]),l(He,{modelValue:t(c),"onUpdate:modelValue":e[12]||(e[12]=a=>r(c)?c.value=a:null),persistent:"",class:"v-dialog-sm"},{default:o(()=>[l(Ce,{onClick:e[10]||(e[10]=a=>c.value=!t(c))}),l(se,{title:"Êtes-vous sûr de vouloir supprimer le ramassage "+t($).code+" ?"},{default:o(()=>[l(ee,{class:"d-flex justify-end gap-3 flex-wrap"},{default:o(()=>[l(U,{color:"secondary",variant:"tonal",onClick:e[11]||(e[11]=a=>c.value=!1)},{default:o(()=>e[17]||(e[17]=[y(" Non ")])),_:1}),l(U,{loading:t(T),onClick:ce},{default:o(()=>e[18]||(e[18]=[y(" Oui ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])]),_:1}),t(w)?(i(),d(we,{key:0,"is-print-ramassage":t(w),"onUpdate:isPrintRamassage":e[13]||(e[13]=a=>r(w)?w.value=a:null),item:t(de)},null,8,["is-print-ramassage","item"])):v("",!0),t(x)?(i(),d(Te,{id:t(ke),key:t(_e),"is-show-item":t(x),"onUpdate:isShowItem":e[14]||(e[14]=a=>r(x)?x.value=a:null),onFetchItems:t(L)},null,8,["id","is-show-item","onFetchItems"])):v("",!0)])}}};export{Mt as default};
