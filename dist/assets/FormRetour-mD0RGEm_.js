import{r as b,P as Q,V as W}from"./VForm-Dg9jF2bh.js";import{s as C}from"./statutInfos-Dl5tZIw7.js";import{c as X,V as Z,_ as ee}from"./VDataTableServer-BdHPifpA.js";import{_ as te}from"./AppSelect-QRYdQcLn.js";import{_ as ae}from"./AppAutocomplete-BgN-K_uu.js";import{_ as le}from"./AppTextField-C8pU9PIj.js";import{j as se,r as u,aq as R,ar as I,w as oe,Y as x,c as z,o as A,d as V,b as e,x as re,e as o,n as a,ak as h,m as ie,s as N,v as j,ai as ne,F as de}from"./index-ozxdH-7b.js";import{$ as B}from"./api-Dx5SAhyB.js";import{t as F}from"./toast-UA7yOy59.js";import{u as ue}from"./index-CuMPislM.js";import{V as _,a as m}from"./VRow-pYCdNr-Y.js";import{V as $}from"./VCard-CNbNQKcS.js";import{V as E}from"./VCardText-DsXbz0Qj.js";import{V as me}from"./VSpacer-BHnw5x-1.js";import{V as O}from"./VChip-DhroVh_v.js";const pe={class:"d-flex flex-wrap justify-start justify-sm-space-between gap-y-4 gap-x-6 mb-6"},fe={class:"d-flex flex-column justify-center"},ce={class:"text-h4 font-weight-medium"},Ve={class:"d-flex flex-wrap gap-4 ma-6"},_e={class:"d-flex gap-4 flex-wrap align-center"},ve={key:0},je={__name:"FormRetour",props:{method:{type:String,required:!0},item:{type:Object,required:!1},identity:{type:String,required:!1}},async setup(D){let n,v;const p=D,M=se(),w=u(),P=u([]),g=u(!1);P.value=([n,v]=R(()=>B("/api/zones").then(l=>l.data.items)),n=await n,v(),n);let q={id:"",nom_vendeur:"",tel_vendeur:"",zone_id:"",adresse:"",colis:[]};const r=u(structuredClone(I(q)));oe(()=>p.item,l=>{p.method=="PUT"&&(r.value={...l})},{immediate:!0});const Y=async()=>{const{valid:l}=await w.value.validate();if(l){let t="/api/retour";p.method=="PUT"&&(t="/api/retour/"+p.identity),g.value=!0,B({method:p.method,url:t,data:r.value}).then(async i=>{var c;i.status===200&&(F.success(i.data),p.method=="POST"?((c=w.value)==null||c.reset(),r.value=structuredClone(I(q))):M.push({name:"retour-list"})),g.value=!1}).catch(i=>{if(g.value=!1,i.response&&i.response.status===422){const c=i.response.data.errors;for(let y in c)F.error(`${y}: ${c[y].join(", ")}`)}})}},G=[{title:"code",key:"code",sortable:!1},{title:"Statut",key:"statut",sortable:!1},{title:"destination",key:"destination",sortable:!1},{title:"Nom du client",key:"nom_client",sortable:!1},{title:"Tel du client",key:"tel_client",sortable:!1}],H=l=>{var t,i;T.value=(t=l.sortBy[0])==null?void 0:t.key,U.value=(i=l.sortBy[0])==null?void 0:i.order},d=u(5),f=u(1),T=u(),U=u(),{data:S,error:ge,statusCode:ye,isFetching:J,execute:be}=([n,v]=R(()=>ue(X("/api/colisCanRetour",{query:{statut_retour:"RETOURNE_ENTREPOT",retour_id:r.value.id,page:f,itemsPerPage:d,sortBy:T,orderBy:U}}))),n=await n,v(),n),K=x(()=>S.value.items),k=x(()=>S.value.total);return(l,t)=>{const i=le,c=ae,y=te,L=ee;return A(),z(de,null,[V("div",pe,[V("div",fe,[V("h4",ce,re(p.method=="POST"?"Ajouter Retour":"Modifier Retour"),1)])]),e(W,{ref_key:"refForm",ref:w,class:"mt-3"},{default:o(()=>[e(_,null,{default:o(()=>[e(m,{cols:"12",class:"pa-0"},{default:o(()=>[e($,{title:"Informations du vendeur"},{default:o(()=>[e(E,null,{default:o(()=>[e(_,null,{default:o(()=>[e(m,{md:"6",cols:"12"},{default:o(()=>[e(i,{modelValue:a(r).nom_vendeur,"onUpdate:modelValue":t[0]||(t[0]=s=>a(r).nom_vendeur=s),rules:["requiredValidator"in l?l.requiredValidator:a(b)],placeholder:"Nom",label:"Nom"},null,8,["modelValue","rules"])]),_:1}),e(m,{cols:"12",md:"6"},{default:o(()=>[e(i,{modelValue:a(r).tel_vendeur,"onUpdate:modelValue":t[1]||(t[1]=s=>a(r).tel_vendeur=s),rules:["requiredValidator"in l?l.requiredValidator:a(b),"PhoneValidator"in l?l.PhoneValidator:a(Q)],label:"Telephone",size:"10",placeholder:"0655554747"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(m,{cols:"12",class:"px-0"},{default:o(()=>[e($,{title:"Informations d'adresse"},{default:o(()=>[e(E,null,{default:o(()=>[e(_,null,{default:o(()=>[e(m,{md:"6",cols:"12"},{default:o(()=>[e(c,{modelValue:a(r).zone_id,"onUpdate:modelValue":t[2]||(t[2]=s=>a(r).zone_id=s),rules:["requiredValidator"in l?l.requiredValidator:a(b)],label:"Destination",items:a(P),"item-title":"zone","item-value":"id",placeholder:"Select State"},null,8,["modelValue","rules","items"])]),_:1}),e(m,{md:"6",cols:"12"},{default:o(()=>[e(i,{modelValue:a(r).adresse,"onUpdate:modelValue":t[3]||(t[3]=s=>a(r).adresse=s),"prepend-inner-icon":"tabler-map-pin",rules:["requiredValidator"in l?l.requiredValidator:a(b)],label:"Adresse",placeholder:"Adresse"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(_,null,{default:o(()=>[e(m,null,{default:o(()=>[V("div",Ve,[e(me),V("div",_e,[e(y,{modelValue:a(d),"onUpdate:modelValue":t[4]||(t[4]=s=>h(d)?d.value=s:null),items:[5,10,20,25,50]},null,8,["modelValue"])])]),e(Z,{"model-value":a(r).colis_ids,"onUpdate:modelValue":t[6]||(t[6]=s=>a(r).colis_ids=s),"items-per-page":a(d),"onUpdate:itemsPerPage":t[7]||(t[7]=s=>h(d)?d.value=s:null),page:a(f),"onUpdate:page":t[8]||(t[8]=s=>h(f)?f.value=s:null),"show-select":"","item-value":s=>s.id,loading:a(J),headers:G,items:a(K),"items-length":a(k),class:"text-no-wrap",locale:"fr","onUpdate:options":H},{"item.statut":o(({item:s})=>[e(O,N(("statutInfos"in l?l.statutInfos:a(C))(s.statut),{density:"default",label:"",size:"small"}),null,16),s.statut_retour?(A(),z("span",ve,[t[9]||(t[9]=j(" - ")),e(O,N(("statutInfos"in l?l.statutInfos:a(C))(s.statut_retour),{density:"default",label:"",size:"small"}),null,16)])):ie("",!0)]),bottom:o(()=>[e(L,{page:a(f),"onUpdate:page":t[5]||(t[5]=s=>h(f)?f.value=s:null),"items-per-page":a(d),"total-items":a(k)},null,8,["page","items-per-page","total-items"])]),_:1},8,["model-value","items-per-page","page","item-value","loading","items","items-length"])]),_:1})]),_:1}),e(_,null,{default:o(()=>[e(m,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:o(()=>[e(ne,{loading:a(g),onClick:Y},{default:o(()=>t[10]||(t[10]=[j(" Enregistrer ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},512)],64)}}};export{je as _};
