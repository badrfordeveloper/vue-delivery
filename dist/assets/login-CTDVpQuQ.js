import{V as B,r as v}from"./VForm-B2WdQWxv.js";import{r as n,i as F,j as R,c as T,o as k,d as l,b as e,n as t,H as b,x as A,e as o,ah as M,f as S,m as E,ai as N,v as $,F as j,aF as g,aw as H}from"./index-Dy7Usk4l.js";import{_ as P}from"./AppTextField-DlXfUlTR.js";import{u as U,_ as G}from"./useAbility-DXNPIP_d.js";import{u as _,a as K,b as Y}from"./misc-mask-light-027o9XEc.js";import{V as z}from"./VNodeRenderer-BdKKJffq.js";import{$ as J}from"./api-I3jvlWdA.js";import{a as u,V as y}from"./VRow-TJvxsZ_y.js";import{V as O}from"./VCard-CeZuMw9F.js";import{V as w}from"./VCardText-BJYEBQo3.js";import{V as Q}from"./VAlert-DHaWwvV_.js";import{V as x}from"./VDivider-BP5tiXxX.js";import"./VInput-DYCyGubC.js";import"./VImg-PvuHZpPc.js";import"./forwardRefs-DWGaNmQL.js";import"./VTextField-CS2auMSB.js";import"./toast-DuLiNZ_C.js";/* empty css              */import"./VAvatar-CRIGdohP.js";const W="/assets/auth-v2-login-illustration-bordered-dark-cDkPk8mY.png",X="/assets/auth-v2-login-illustration-bordered-light-CIHqcIVA.png",Z="/assets/auth-v2-login-illustration-dark-ClExSVqL.png",ee="/assets/auth-v2-login-illustration-light-C4sKfRS1.png",ae={href:"javascript:void(0)"},te={class:"auth-logo d-flex align-center gap-x-3"},se={class:"auth-title"},oe={class:"position-relative bg-background w-100 me-0"},le=["src"],Le={__name:"login",setup(re){const m=n(!1);_(ee,Z,X,W,!0);const C=_(Y,K),L=U(),V=F(),q=R(),i=n({email:"admin@gmail.com",password:"",remember:!1}),h=n(),c=n(!1),d=n(!1),f=n(!1),D=async()=>{try{d.value=!1,f.value=!0,J.post("/api/auth/login",{email:i.value.email,password:i.value.password}).then(async s=>{const{accessToken:a,userData:p,userAbilityRules:r}=s.data;g("userAbilityRules").value=r,L.update(r),g("userData").value=p,g("accessToken").value=a,d.value=!1,await H(()=>{q.replace(V.query.to?String(V.query.to):"/")})}).catch(s=>{s.status===403?(c.value=s.response.data.message,d.value=!0):s.status===422&&(c.value="Email ou mot de passe est incorrect",d.value=!0),console.log("error login")}).then(()=>{f.value=!1})}catch(s){console.error(s)}},I=()=>{var s;(s=h.value)==null||s.validate().then(({valid:a})=>{a&&D()})};return(s,a)=>{const p=P;return k(),T(j,null,[l("a",ae,[l("div",te,[e(t(z),{nodes:t(b).app.logo},null,8,["nodes"]),l("h1",se,A(t(b).app.title),1)])]),e(y,{"no-gutters":"",class:"auth-wrapper bg-surface"},{default:o(()=>[e(u,{md:"8",class:"d-none d-md-flex"},{default:o(()=>[l("div",oe,[l("img",{class:"auth-footer-mask flip-in-rtl",src:t(C),alt:"auth-footer-mask",height:"280",width:"100"},null,8,le)])]),_:1}),e(u,{cols:"12",md:"4",class:"auth-card-v2 d-flex align-center justify-center"},{default:o(()=>[e(O,{flat:"","max-width":500,class:"mt-12 mt-sm-0 pa-6"},{default:o(()=>[e(w,null,{default:o(()=>a[3]||(a[3]=[l("h4",{class:"text-h4 mb-1"}," Login ",-1)])),_:1}),e(w,null,{default:o(()=>[e(B,{ref_key:"refVForm",ref:h,onSubmit:M(I,["prevent"])},{default:o(()=>[e(y,null,{default:o(()=>[t(d)?(k(),S(Q,{key:0,title:t(c),type:"error"},null,8,["title"])):E("",!0),e(u,{cols:"12"},{default:o(()=>[e(p,{modelValue:t(i).email,"onUpdate:modelValue":a[0]||(a[0]=r=>t(i).email=r),rules:["requiredValidator"in s?s.requiredValidator:t(v)],autofocus:"",label:"Email",type:"email",placeholder:"test@gmail.com"},null,8,["modelValue","rules"])]),_:1}),e(u,{cols:"12"},{default:o(()=>[e(p,{modelValue:t(i).password,"onUpdate:modelValue":a[1]||(a[1]=r=>t(i).password=r),rules:["requiredValidator"in s?s.requiredValidator:t(v)],label:"Mot de passe",placeholder:"············",type:t(m)?"text":"password",autocomplete:"password","append-inner-icon":t(m)?"tabler-eye-off":"tabler-eye","onClick:appendInner":a[2]||(a[2]=r=>m.value=!t(m))},null,8,["modelValue","rules","type","append-inner-icon"]),a[5]||(a[5]=l("div",{class:"my-5"},null,-1)),e(N,{loading:t(f),block:"",type:"submit"},{default:o(()=>a[4]||(a[4]=[$(" Login ")])),_:1},8,["loading"])]),_:1}),e(u,{cols:"12",class:"d-flex align-center"},{default:o(()=>[e(x),a[6]||(a[6]=l("span",{class:"mx-4"},"or",-1)),e(x)]),_:1}),e(u,{cols:"12",class:"text-center"},{default:o(()=>[e(G)]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})],64)}}};export{Le as default};
