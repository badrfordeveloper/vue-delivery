import{s as W}from"./statutInfos-Dl5tZIw7.js";import{r as te,V as Me}from"./VForm-B2WdQWxv.js";import{r as i,w as ae,Y as Q,c as B,o as m,b as t,F as ne,h as fe,f as _,e as a,v as C,x as $,n as e,ak as A,d as n,m as w,ai as q,A as K,aq as re,ar as ve,J as Oe,$ as ue,s as ce,K as Ue,j as st,a as lt}from"./index-Dy7Usk4l.js";import{_ as je,V as ot,a as nt,b as rt,c as De,d as ut}from"./VTabs-C_tR7TEn.js";import{_ as _e}from"./AppTextField-DlXfUlTR.js";import{_ as we}from"./AppSelect-zFLYJ9eC.js";import{_ as Fe}from"./AppTextarea-D5Dr80Xg.js";import{_ as Ge,a as me,s as be,e as $e,b as it}from"./AppDateTimePicker-wp6i1oBm.js";import{$ as z}from"./api-I3jvlWdA.js";import{t as N}from"./toast-DuLiNZ_C.js";import{V as Ne}from"./VAlert-DHaWwvV_.js";import{V as M,a as y}from"./VRow-TJvxsZ_y.js";import{V as ee,a as pe}from"./VList-CoYFBUIe.js";import{_ as Se}from"./DialogCloseBtn-BmdHgrps.js";import{V as ge}from"./VCard-CeZuMw9F.js";import{V as ie}from"./VCardText-BJYEBQo3.js";import{V as Pe}from"./VTable-D2Bc35sF.js";import{V as Be}from"./VChip-BSfE2IS9.js";import{V as Ve}from"./VDivider-BP5tiXxX.js";import{V as dt}from"./VDataTable-Cn6Ricxf.js";import{V as ke}from"./VDialog-M9Mknjwd.js";import{_ as mt}from"./printGroupColis-DF88lc9r.js";import{V as pt,_ as ct,c as ft}from"./VDataTableServer-DbCqujNz.js";import{_ as vt}from"./AppAutocomplete-BNs06TK5.js";import{_ as gt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{c as _t}from"./constants-YGND1LPw.js";import{u as yt}from"./index-6mxt0aF2.js";import{V as bt}from"./VSpacer-B3LBRedx.js";import{V as qe}from"./VMenu-CHE0SPqv.js";import{s as Vt}from"./startOfWeek-BX0W9kO8.js";import"./VInput-DYCyGubC.js";import"./VImg-PvuHZpPc.js";import"./forwardRefs-DWGaNmQL.js";import"./VOverlay-DlNjFQ7t.js";import"./VSlideGroup-BVkuM_qe.js";import"./VTextField-CS2auMSB.js";import"./VSelect-L2jyr6ga.js";import"./VCheckboxBtn-DZVWJIp7.js";import"./VSelectionControl-D23KI5kr.js";import"./VAvatar-CRIGdohP.js";/* empty css              */import"./filter-BNkad7X9.js";import"./VNodeRenderer-BdKKJffq.js";const wt={__name:"Entrepot",props:{item:{type:Object,required:!0},isShowEntrepot:{type:Boolean,required:!0}},emits:["hideEntrepot","getItemData"],setup(Y,{emit:E}){const S=Y,F=E,O=i({}),k=i("");ae(()=>S.item,s=>{O.value=s},{immediate:!0});const R=i(),h=i(!1),o=i([]),x=i([]),I=i([]),b=i(!1),T=i(!1),G=async()=>{const{valid:s}=await R.value.validate();s&&await V()},H=()=>{F("hideEntrepot")},V=s=>{h.value=!0,b.value=!1,b.value=!1,z({method:"POST",url:"/api/scannerEntrepot",data:{ramassage_id:O.value.id,commonColis:f.value,duplicatedColis:u.value,externeColis:p.value,missingColis:D.value}}).then(async d=>{if(d.status===200){let v=d.data;console.log(v),o.value=v.success,x.value=v.errors,I.value=v.colisError,b.value=!0,T.value=x.value.length==0,x.value.length==0&&F("getItemData")}h.value=!1}).catch(d=>{h.value=!1,d.response&&d.response.status===422?N.error(d.response.data.message):N.error("something wrong")})},g=Q(()=>O.value.colis.map(s=>s.code)),U=Q(()=>k.value?k.value.split(`
`).map(s=>s.trim()).filter(s=>s.length>0):[]),u=Q(()=>U.value.filter((s,d,v)=>v.indexOf(s)!==d)),p=Q(()=>{const s=new Set(g.value);let d=U.value.filter(v=>!s.has(v));return d=new Set(d),[...d]}),D=Q(()=>{const s=new Set(U.value);return g.value.filter(d=>!s.has(d))}),f=Q(()=>{const s=new Set(g.value),d=new Set(U.value);return[...s].filter(v=>d.has(v))});return(s,d)=>{const v=Fe;return m(),B(ne,null,[(m(!0),B(ne,null,fe(e(o),(L,X)=>(m(),_(Ne,{key:X,modelValue:e(T),"onUpdate:modelValue":d[0]||(d[0]=j=>A(T)?T.value=j:null),color:"success",class:"ma-1"},{default:a(()=>[C($(L),1)]),_:2},1032,["modelValue"]))),128)),(m(!0),B(ne,null,fe(e(x),(L,X)=>(m(),_(Ne,{key:X,modelValue:e(b),"onUpdate:modelValue":d[1]||(d[1]=j=>A(b)?b.value=j:null),color:"error",class:"ma-1"},{default:a(()=>[C($(L),1)]),_:2},1032,["modelValue"]))),128)),t(Me,{ref_key:"refForm",ref:R,class:"mt-3"},{default:a(()=>[n("div",null,[t(M,{class:"d-flex align-center justify-center"},{default:a(()=>[t(y,{cols:"12"},{default:a(()=>[t(v,{modelValue:e(k),"onUpdate:modelValue":d[2]||(d[2]=L=>A(k)?k.value=L:null),rows:"5","row-height":"20",label:"Scanner",rules:["requiredValidator"in s?s.requiredValidator:e(te)],placeholder:"Select pour scanner"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),t(M,null,{default:a(()=>[e(I).length>0?(m(),_(y,{key:0,cols:"12",md:"3"},{default:a(()=>[d[3]||(d[3]=n("p",{class:"text-error"}," Colis erroné ",-1)),t(ee,{items:e(I),class:"border border-error border-opacity-75"},null,8,["items"])]),_:1})):w("",!0),e(u).length>0?(m(),_(y,{key:1,cols:"12",md:"3"},{default:a(()=>[d[4]||(d[4]=n("p",{class:"text-error"}," Colis dupliqués ",-1)),t(ee,{items:e(u),class:"border border-error border-opacity-75"},null,8,["items"])]),_:1})):w("",!0),t(y,{cols:"12",md:"3"},{default:a(()=>[d[5]||(d[5]=C(" Colis manquant ")),t(ee,{items:e(D)},null,8,["items"])]),_:1}),t(y,{cols:"12",md:"3"},{default:a(()=>[d[6]||(d[6]=C(" Colis externe ")),t(ee,{items:e(p)},null,8,["items"])]),_:1})]),_:1}),t(M,null,{default:a(()=>[t(y,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:a(()=>[t(q,{color:"secondary",onClick:H},{default:a(()=>d[7]||(d[7]=[C(" retour ")])),_:1}),t(q,{loading:e(h),onClick:G},{default:a(()=>d[8]||(d[8]=[C(" Envoyer ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},512)],64)}}},St={key:0},kt={key:1},ht={class:"text-center"},At={key:0},Ct={key:1},Et={__name:"actionsRamassage",props:{currentStatut:{type:String,required:!0},item:{type:Object,required:!0},id:{type:Number,required:!0}},emits:["getItemData"],setup(Y,{emit:E}){const S=Y,F=E,O=i({}),k=i(""),R=i(!1),h=i(),o=i({id:null,statut:"",nombre_colis_ramasseur:"",commentaire:"",date:"",file:""}),x=()=>{R.value=!1,b.value=!1};ae(()=>S.currentStatut,u=>{k.value=u},{immediate:!0}),ae(()=>S.item,u=>{O.value=u},{immediate:!0});const I=i(""),b=i(!1),T=u=>{R.value=!0,o.value.statut=u,u=="ENTREPOT"&&(b.value=!0)},G=async()=>{const{valid:u}=await h.value.validate();u&&await H(o.value.statut)},H=async u=>{o.value.statut=u,o.value.id=S.id,I.value=u,z({method:"POST",url:"/api/updateStatutRamassage",data:o.value}).then(async p=>{p.status===200&&(N.success(p.data),u!="COMMENTAIRE"&&(k.value=u),R.value=!1,F("getItemData")),I.value=""}).catch(p=>{I.value="",p.response&&p.response.status===422?N.error(p.response.data.message):N.error("something wrong")})},V=K("livreur","action"),g=K("gestionnaire","action"),U=Q(()=>{let u=[];return u.push({text:"Commentaire",color:"secondary",statut:"COMMENTAIRE"}),k.value=="REPORTE"&&(V||g)&&u.push({...W("EN_COURS_RAMASSAGE"),statut:"EN_COURS_RAMASSAGE"}),k.value=="EN_ATTENTE"?V&&u.push({...W("EN_COURS_RAMASSAGE"),statut:"EN_COURS_RAMASSAGE"}):k.value=="EN_COURS_RAMASSAGE"||k.value=="REPORTE"?(V&&(u.push({statut:"RAMASSE",...W("RAMASSE")}),u.push({statut:"REPORTE",...W("REPORTE")})),g&&u.push({statut:"ANNULE",...W("ANNULE")})):k.value=="RAMASSE"&&g&&(u.push({...W("ENTREPOT"),statut:"ENTREPOT"}),O.value.colis.length==0&&u.push({statut:"ANNULE",...W("ANNULE")})),u});return(u,p)=>{const D=wt,f=_e,s=Ge,d=Fe;return e(R)?(m(),B("div",kt,[e(o).statut=="ENTREPOT"&&e(b)?(m(),_(D,{key:0,"is-show-entrepot":e(b),"onUpdate:isShowEntrepot":p[0]||(p[0]=v=>A(b)?b.value=v:null),"hide-entrepot":"",item:e(O),onHideEntrepot:x,onGetItemData:p[1]||(p[1]=v=>F("getItemData"))},null,8,["is-show-entrepot","item"])):(m(),_(Me,{key:1,ref_key:"refForm",ref:h,class:"mt-3"},{default:a(()=>[n("p",ht," Statut à envoyer : "+$(("statutInfos"in u?u.statutInfos:e(W))(e(o).statut).text),1),e(o).statut=="RAMASSE"?(m(),B("div",At,[t(M,{class:"d-flex align-center justify-center"},{default:a(()=>[t(y,{md:"6",cols:"12"},{default:a(()=>[t(f,{modelValue:e(o).nombre_colis_ramasseur,"onUpdate:modelValue":p[2]||(p[2]=v=>e(o).nombre_colis_ramasseur=v),rules:["requiredValidator"in u?u.requiredValidator:e(te)],placeholder:"Nombre de colis",label:"Nombre de colis",type:"number"},null,8,["modelValue","rules"])]),_:1})]),_:1})])):w("",!0),e(o).statut=="REPORTE"?(m(),B("div",Ct,[t(M,{class:"d-flex align-center justify-center"},{default:a(()=>[t(y,{md:"6",cols:"12"},{default:a(()=>[t(s,{modelValue:e(o).date,"onUpdate:modelValue":p[3]||(p[3]=v=>e(o).date=v),rules:["requiredValidator"in u?u.requiredValidator:e(te)],label:"Date & TIme",placeholder:"Select date and time",config:{enableTime:!1,dateFormat:"Y-m-d"}},null,8,["modelValue","rules"])]),_:1})]),_:1})])):w("",!0),n("div",null,[t(M,{class:"d-flex align-center justify-center"},{default:a(()=>[t(y,{md:"6",cols:"12"},{default:a(()=>[t(d,{modelValue:e(o).commentaire,"onUpdate:modelValue":p[4]||(p[4]=v=>e(o).commentaire=v),rows:"2","row-height":"20",label:"Commentaire",rules:["COMMENTAIRE","REPORTE","ANNULE"].includes(e(o).statut)?["requiredValidator"in u?u.requiredValidator:e(te)]:[],placeholder:"Commentaire"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),t(M,null,{default:a(()=>[t(y,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:a(()=>[t(q,{color:"secondary",onClick:p[5]||(p[5]=v=>R.value=!1)},{default:a(()=>p[6]||(p[6]=[C(" retour ")])),_:1}),t(q,{loading:e(I)==e(o).statut,onClick:G},{default:a(()=>p[7]||(p[7]=[C(" Envoyer ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},512))])):(m(),_(M,{key:0,class:"text-center v-row m-0"},{default:a(()=>[(m(!0),B(ne,null,fe(e(U),(v,L)=>(m(),_(y,{key:L,cols:"6"},{default:a(()=>[t(q,{color:v.color,loading:e(I)==v.statut,style:{width:"inherit"},onClick:X=>T(v.statut)},{default:a(()=>[C($(v.text),1)]),_:2},1032,["color","loading","onClick"])]),_:2},1024))),128)),e(U).length==0?(m(),B("div",St," Aucune action requise ")):w("",!0)]),_:1}))}}},Rt={key:0,class:"text-end position-absolute right-0"},xt={class:"text-body-1 mb-2"},It={class:"text-body-1 mb-2"},Tt={class:"text-body-1 mb-2"},Ot={key:0},Ut={class:"text-body-1 mb-2"},Dt={class:"text-body-1 mb-2"},$t={class:"text-body-1 mb-2"},Nt={class:"text-body-1 mb-2"},Pt={class:"text-body-1 mb-2"},qt={class:"text-body-1 mb-2"},Mt={class:"text-body-1 mb-2"},jt={__name:"ShowRamassage",props:{id:{type:Object,required:!1},isShowItem:{type:Boolean,required:!0}},emits:["update:isShowItem","fetchItems"],async setup(Y,{emit:E}){let S,F;const O=Y,k=E;let R={id:"",nom_vendeur:"",tel_vendeur:"",frais_ramasseur:"",tel_ramasseur:"",tarif_id:"",adresse:"",ramasseur:"",ramasseur_id:"",statut:"",vendeur:"",nombre_colis:"",colis:[],histories:[]};const h=([S,F]=re(()=>z("/api/ramasseurs").then(f=>f.data)),S=await S,F(),S),o=i(structuredClone(ve(R))),x=i(!1),I=async f=>{x.value=!0,await z("/api/ramassage/"+f).then(async s=>{s.status===200&&(o.value=s.data),x.value=!1}).catch(s=>{x.value=!1,s.response&&s.response.status===422?N.error(s.response.data.message):N.error("something wrong")})};ae(()=>O.id,f=>{I(f)},{immediate:!0});const b=()=>{k("update:isShowItem",!1),k("fetchItems"),o.value=structuredClone(ve(R))},T=i(!1),G=K("gestionnaire","action"),H=K("livreur","action"),V=f=>{T.value=!0,z({method:"POST",url:"/api/parametrerRamassage",data:{id:o.value.id,ramasseur_id:o.value.ramasseur_id,frais_ramasseur:o.value.frais_ramasseur}}).then(async s=>{T.value=!1,s.status===200&&N.success(s.data),I(o.value.id),u.value=!1}).catch(s=>{T.value=!1,s.response&&s.response.status===422?N.error(s.response.data.message):N.error("something wrong")})},g=i("Actions"),U=["tabler-adjustments-share","tabler-logs"],u=i(!1),p=[{title:"code",key:"code"},{title:"destination",key:"destination"}],D=()=>{let f=o.value.tel_vendeur;f=f.replace(/\D/g,""),f.startsWith("0")?f="+212"+f.substring(1):f.startsWith("+")||(f="+212"+f);const s=`
 Dropoff سلام، أنا موزع لدى 
 وسأتولى استلام طردكم اليوم. يُرجى مشاركة موقعكم لتسهيل عملية الاستلام. نشكركم على ثقتكم في خدماتنا 
Bonjour, je suis livreur chez Dropoff et je prendrai en charge la collecte de votre colis aujourd'hui. Merci de partager votre localisation pour faciliter le ramassage. Nous vous remercions pour votre confiance.
`.trim(),d=encodeURIComponent(s);window.open(`https://wa.me/${f}?text=${d}`,"_blank")};return(f,s)=>{const d=Se,v=Et,L=ut,X=we,j=_e,J=je;return m(),_(ke,{width:f.$vuetify.display.smAndDown?"auto":900,"model-value":O.isShowItem,scrollable:"","onUpdate:modelValue":b},{default:a(()=>[t(d,{onClick:b}),t(J,{title:"Details Ramassage",loading:e(x),style:{overflow:"scroll","max-height":"90vh"},"no-actions":""},{default:a(()=>[t(ge,null,{default:a(()=>[Oe(t(ie,null,{default:a(()=>[e(G)?(m(),B("div",Rt,[t(q,{icon:"",class:"rounded-0",onClick:s[0]||(s[0]=P=>u.value=!0)},{default:a(()=>[t(ue,{size:"22",icon:"tabler-settings"})]),_:1})])):w("",!0),t(M,null,{default:a(()=>[t(y,{cols:"12",lg:"6"},{default:a(()=>[t(Pe,{class:"billing-address-table"},{default:a(()=>[n("tr",null,[s[7]||(s[7]=n("td",null,[n("h6",{class:"text-h6 text-no-wrap mb-2"}," Code : ")],-1)),n("td",null,[n("p",xt,$(e(o).code),1)])]),n("tr",null,[s[8]||(s[8]=n("td",null,[n("h6",{class:"text-h6 text-no-wrap mb-2"}," Ramasseur : ")],-1)),n("td",null,[n("p",It,$(e(o).ramasseur),1)])]),n("tr",null,[s[9]||(s[9]=n("td",null,[n("h6",{class:"text-h6 text-no-wrap mb-2"}," Tel Ramasseur: ")],-1)),n("td",null,[n("p",Tt,$(e(o).tel_ramasseur),1)])]),e(H)?(m(),B("tr",Ot,[s[10]||(s[10]=n("td",null,[n("h6",{class:"text-h6 text-no-wrap mb-2"}," Frais de ramassage: ")],-1)),n("td",null,[n("p",Ut,$(e(o).frais_ramasseur),1)])])):w("",!0),n("tr",null,[s[11]||(s[11]=n("td",null,[n("h6",{class:"text-h6 text-no-wrap mb-2"}," Destination : ")],-1)),n("td",null,[n("p",Dt,$(e(o).destination),1)])]),n("tr",null,[s[12]||(s[12]=n("td",null,[n("h6",{class:"text-h6 text-no-wrap mb-2"}," Adresse : ")],-1)),n("td",null,[n("p",$t,$(e(o).adresse),1)])]),n("tr",null,[s[13]||(s[13]=n("td",null,[n("h6",{class:"text-h6 text-no-wrap mb-2"}," Statut: ")],-1)),n("td",null,[n("p",Nt,[t(Be,ce(("statutInfos"in f?f.statutInfos:e(W))(e(o).statut),{density:"default",label:"",size:"small"}),null,16)])])])]),_:1})]),_:1}),t(y,{cols:"12",lg:"6"},{default:a(()=>[t(Pe,{class:"billing-address-table"},{default:a(()=>[n("tr",null,[s[14]||(s[14]=n("td",null,[n("h6",{class:"text-h6 text-no-wrap mb-2"}," Vendeur: ")],-1)),n("td",null,[n("p",Pt,$(e(o).vendeur),1)])]),n("tr",null,[s[15]||(s[15]=n("td",null,[n("h6",{class:"text-h6 text-no-wrap mb-2"}," Tel Vendeur: ")],-1)),n("td",null,[n("p",qt,[C($(e(o).tel_vendeur)+" ",1),e(H)?(m(),_(q,{key:0,color:"test",icon:"",onClick:D},{default:a(()=>[t(ue,{color:"success",size:"30",icon:"tabler-brand-whatsapp"})]),_:1})):w("",!0)])])]),n("tr",null,[s[16]||(s[16]=n("td",null,[n("h6",{class:"text-h6 text-no-wrap mb-2"}," Colis: ")],-1)),n("td",null,[n("p",Mt,$(e(o).nombre_colis),1)])])]),_:1})]),_:1})]),_:1}),t(ot,{modelValue:e(g),"onUpdate:modelValue":s[1]||(s[1]=P=>A(g)?g.value=P:null),grow:"",class:"disable-tab-transition",stacked:""},{default:a(()=>[(m(),B(ne,null,fe(U,(P,de)=>t(nt,{key:de},{default:a(()=>[t(ue,{size:"40",icon:P},null,8,["icon"])]),_:2},1024)),64))]),_:1},8,["modelValue"]),t(rt,{modelValue:e(g),"onUpdate:modelValue":s[3]||(s[3]=P=>A(g)?g.value=P:null),class:"mt-3"},{default:a(()=>[t(De,null,{default:a(()=>[t(v,{id:e(o).id,"current-statut":e(o).statut,item:e(o),onGetItemData:s[2]||(s[2]=P=>I(e(o).id))},null,8,["id","current-statut","item"])]),_:1}),t(De,null,{default:a(()=>[t(L,{histories:e(o).histories},null,8,["histories"])]),_:1})]),_:1},8,["modelValue"]),t(Ve,{color:"white",thickness:"1",opacity:"0.2",class:"my-6"}),t(dt,{headers:p,items:e(o).colis,"items-per-page":5},null,8,["items"])]),_:1},512),[[Ue,!e(u)]]),e(G)?Oe((m(),_(ie,{key:0},{default:a(()=>[t(M,null,{default:a(()=>[t(y,{md:"6",cols:"12"},{default:a(()=>[t(X,{modelValue:e(o).ramasseur_id,"onUpdate:modelValue":s[4]||(s[4]=P=>e(o).ramasseur_id=P),placeholder:"Ramasseurs",label:"Ramasseurs",items:e(h),clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1}),t(y,{cols:"12",md:"6"},{default:a(()=>[t(j,{modelValue:e(o).frais_ramasseur,"onUpdate:modelValue":s[5]||(s[5]=P=>e(o).frais_ramasseur=P),rules:["requiredValidator"in f?f.requiredValidator:e(te)],label:"Frais de ramassage",type:"number",placeholder:"Frais de ramassage"},null,8,["modelValue","rules"])]),_:1})]),_:1}),t(M,null,{default:a(()=>[t(y,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:a(()=>[t(q,{color:"secondary",onClick:s[6]||(s[6]=P=>u.value=!1)},{default:a(()=>s[17]||(s[17]=[C(" retour ")])),_:1}),t(q,{loading:e(T),onClick:V},{default:a(()=>s[18]||(s[18]=[C(" Envoyer ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},512)),[[Ue,e(u)]]):w("",!0)]),_:1})]),_:1},8,["loading"])]),_:1},8,["width","model-value"])}}},Ft={__name:"GroupActionsRamassage",props:{items:{type:Object,required:!0},isShowItem:{type:Boolean,required:!0}},emits:["update:isShowItem","fetchItems","resetSelectedRows"],async setup(Y,{emit:E}){let S,F;const O=Y,k=E;let R={frais_ramasseur:"",ramasseur_id:""};const h=([S,F]=re(()=>z("/api/ramasseurs").then(V=>V.data)),S=await S,F(),S),o=i(structuredClone(ve(R))),x=i(!1),I=i();ae(()=>O.items,V=>{I.value=V.map(g=>g.id)},{immediate:!0,deep:!0});const b=()=>{k("update:isShowItem",!1),k("fetchItems"),k("resetSelectedRows"),o.value=structuredClone(ve(R))},T=K("gestionnaire","action"),G=i(!1),H=async()=>{G.value=!0,await z({method:"POST",url:"/api/parametrerGroupRamassage",data:{ids:I.value,ramasseur_id:o.value.ramasseur_id,frais_ramasseur:o.value.frais_ramasseur}}).then(async V=>{V.status===200&&(N.success(V.data),b()),G.value=!1}).catch(V=>{G.value=!1,V.response&&V.response.status===422?N.error(V.response.data.message):N.error("something wrong")})};return(V,g)=>{const U=Se,u=we,p=_e,D=je;return m(),_(ke,{width:V.$vuetify.display.smAndDown?"auto":900,"model-value":O.isShowItem,"onUpdate:modelValue":b},{default:a(()=>[t(U,{onClick:b}),t(D,{title:"Affectation des Ramassages",style:{overflow:"scroll","max-height":"90vh"},loading:e(x),"no-actions":""},{default:a(()=>[t(ge,null,{default:a(()=>[e(T)?(m(),_(ie,{key:0},{default:a(()=>[t(M,null,{default:a(()=>[t(y,{md:"6",cols:"12"},{default:a(()=>[t(u,{modelValue:e(o).ramasseur_id,"onUpdate:modelValue":g[0]||(g[0]=f=>e(o).ramasseur_id=f),placeholder:"Ramasseurs",label:"Ramasseurs",items:e(h),clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1}),t(y,{cols:"12",md:"6"},{default:a(()=>[t(p,{modelValue:e(o).frais_ramasseur,"onUpdate:modelValue":g[1]||(g[1]=f=>e(o).frais_ramasseur=f),rules:["requiredValidator"in V?V.requiredValidator:e(te)],label:"Frais de ramasseur",type:"number",placeholder:"Frais de ramasseur"},null,8,["modelValue","rules"])]),_:1})]),_:1}),t(M,null,{default:a(()=>[t(y,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:a(()=>[t(q,{loading:e(G),onClick:H},{default:a(()=>g[2]||(g[2]=[C(" Envoyer ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})):w("",!0)]),_:1})]),_:1},8,["loading"])]),_:1},8,["width","model-value"])}}},Gt=gt(Ft,[["__scopeId","data-v-b9ac1942"]]),Bt={class:"d-flex flex-wrap gap-4 ma-6"},Lt={class:"d-flex gap-4 flex-wrap align-center"},Wt={key:1},Pa={__name:"index",props:{statut:{type:String,required:!0}},async setup(Y){let E,S;const F=Y,O=i(!1),k=i([{title:"Aujourd'hui",value:"today"},{title:"Hier",value:"yesterday"},{title:"La semaine dernière",value:"lastWeek"},{title:"Ce mois",value:"thisMonth"},{title:"Le mois précédent",value:"lastMonth"},{title:"Personnalisé",value:"custom"}]),R=K("gestionnaire","action"),h=i(),o=i(),x=i("today"),I=()=>{const c=new Date;switch(O.value=x.value==="custom",x.value){case"today":h.value=c.toISOString().split("T")[0],o.value=c.toISOString().split("T")[0];break;case"yesterday":const l=me(c,-1);h.value=l.toISOString().split("T")[0],o.value=l.toISOString().split("T")[0];break;case"lastWeek":h.value=Vt(me(c,-7)).toISOString().split("T")[0],o.value=it(me(c,-7)).toISOString().split("T")[0];break;case"thisMonth":h.value=be(c).toISOString().split("T")[0],o.value=$e(c).toISOString().split("T")[0];break;case"lastMonth":const Z=me(be(c),-1);h.value=be(Z).toISOString().split("T")[0],o.value=$e(Z).toISOString().split("T")[0];break}};I();const b=i(),T=i(),G=([E,S]=re(()=>z("/api/ramasseurs").then(c=>c.data)),E=await E,S(),E),H=([E,S]=re(()=>z("/api/vendeurs").then(c=>c.data)),E=await E,S(),E),V=[{title:"code",key:"code",sortable:!1},{title:"Statut",key:"statut",sortable:!1},{title:"destination",key:"destination",sortable:!1},{title:"Nombre de colis",key:"nombre_colis",sortable:!1},{title:"Vendeur",key:"vendeur",sortable:!1},{title:"actions",key:"actions",sortable:!1}],g=i(),U=i(),u=i([]),p=i(!1),D=i(!1),f=i(),s=i(!1),d=i(!1),v=i(),L=i();ae(()=>F.statut,c=>{U.value=c},{immediate:!0});const X=async c=>{d.value=!0,await z("/api/ramassage/"+c.id).then(async l=>{l.status===200&&(s.value=!0,v.value=l.data.colis,L.value=c.vendeur),d.value=!1}).catch(l=>{d.value=!1,l.response&&l.response.status===422?N.error(l.response.data.message):N.error("something wrong")})},j=i(5),J=i(1),P=i(),de=i(),Le=c=>{D.value=!0,f.value=c},We=async()=>{let c="/api/ramassage/"+f.value.id;p.value=!0,z({method:"DELETE",url:c}).then(async l=>{l.status===200&&(D.value=!1,N.success(l.data),Ae()),p.value=!1}).catch(l=>{p.value=!1})},ze=c=>{var l,Z;P.value=(l=c.sortBy[0])==null?void 0:l.key,de.value=(Z=c.sortBy[0])==null?void 0:Z.order},{data:he,error:zt,statusCode:Ht,isFetching:He,execute:Ae}=([E,S]=re(()=>yt(ft("/api/ramassage",{query:{livreur_id:b,vendeur_id:T,begin_date:h,end_date:o,code:g,statut:U,page:J,itemsPerPage:j,sortBy:P,orderBy:de}}))),E=await E,S(),E),Ce=st(),Ke=Q(()=>he.value.items),Ee=Q(()=>he.value.total),se=i(!1),Re=i(0),xe=i(0),Ye=c=>{xe.value=c.id,Re.value++,se.value=!0},Je=()=>{u.value=[]},le=i(!1),Qe=c=>{le.value=!0};return(c,l)=>{const Z=vt,ye=we,Xe=_e,Ie=Ge,Te=lt("IconBtn"),Ze=ct,et=Se,tt=mt,at=jt;return m(),B("div",null,[t(ge,{title:"Filtres",class:"mb-6 d-print-none"},{default:a(()=>[t(ie,null,{default:a(()=>[t(M,null,{default:a(()=>[e(R)?(m(),_(y,{key:0,cols:"12",sm:"3"},{default:a(()=>[t(Z,{modelValue:e(T),"onUpdate:modelValue":l[0]||(l[0]=r=>A(T)?T.value=r:null),placeholder:"Vendeurs",items:e(H),clearable:"","clear-icon":"tabler-x",autocomplete:"no-autocompeletse"},null,8,["modelValue","items"])]),_:1})):w("",!0),e(R)?(m(),_(y,{key:1,cols:"12",sm:"3"},{default:a(()=>[t(Z,{modelValue:e(b),"onUpdate:modelValue":l[1]||(l[1]=r=>A(b)?b.value=r:null),placeholder:"Livreurs",items:e(G),clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1})):w("",!0),t(y,{cols:"12",sm:"3"},{default:a(()=>[t(ye,{modelValue:e(U),"onUpdate:modelValue":l[2]||(l[2]=r=>A(U)?U.value=r:null),placeholder:"Statut",items:e(_t),clearable:"","clear-icon":"tabler-x"},{item:a(({item:r,props:oe})=>[t(pe,ce(oe,{title:("statutInfos"in c?c.statutInfos:e(W))(r.value).text}),null,16,["title"])]),selection:a(({item:r})=>[C($(("statutInfos"in c?c.statutInfos:e(W))(r.value).text),1)]),_:1},8,["modelValue","items"])]),_:1}),t(y,{cols:"12",sm:"2"},{default:a(()=>[t(Xe,{modelValue:e(g),"onUpdate:modelValue":l[3]||(l[3]=r=>A(g)?g.value=r:null),placeholder:"Code"},null,8,["modelValue"])]),_:1})]),_:1}),t(M,null,{default:a(()=>[t(y,{cols:"12",sm:"3"},{default:a(()=>[t(ye,{modelValue:e(x),"onUpdate:modelValue":[l[4]||(l[4]=r=>A(x)?x.value=r:null),I],placeholder:"Plage de dates",items:e(k),label:e(h)+" - "+e(o)},null,8,["modelValue","items","label"])]),_:1}),e(O)?(m(),_(y,{key:0,cols:"12",sm:"3"},{default:a(()=>[t(Ie,{modelValue:e(h),"onUpdate:modelValue":l[5]||(l[5]=r=>A(h)?h.value=r:null),label:"Début",placeholder:"date"},null,8,["modelValue"])]),_:1})):w("",!0),e(O)?(m(),_(y,{key:1,cols:"12",sm:"3"},{default:a(()=>[t(Ie,{modelValue:e(o),"onUpdate:modelValue":l[6]||(l[6]=r=>A(o)?o.value=r:null),label:"Fin",placeholder:"date"},null,8,["modelValue"])]),_:1})):w("",!0)]),_:1})]),_:1}),t(Ve),n("div",Bt,[t(bt),n("div",Lt,[c.isActionVendeur||e(R)?(m(),_(qe,{key:0},{activator:a(({props:r})=>[t(q,ce({color:"secondary"},r),{default:a(()=>l[19]||(l[19]=[C(" Group actions ")])),_:2},1040)]),default:a(()=>[t(ee,null,{default:a(()=>[e(R)?(m(),_(pe,{key:0,value:"print","prepend-icon":"tabler-text-scan-2",onClick:Qe},{default:a(()=>l[20]||(l[20]=[C(" Affectation ")])),_:1})):w("",!0)]),_:1})]),_:1})):w("",!0),t(ye,{modelValue:e(j),"onUpdate:modelValue":l[7]||(l[7]=r=>A(j)?j.value=r:null),items:[5,10,20,25,50]},null,8,["modelValue"]),e(K)("create","ramassage")?(m(),_(q,{key:1,color:"primary","prepend-icon":"tabler-plus",onClick:l[8]||(l[8]=r=>e(Ce).push({name:"ramassage-add"}))},{default:a(()=>l[21]||(l[21]=[C(" Ajouter Ramassage ")])),_:1})):w("",!0)])]),t(Ve,{class:"mt-4"}),t(pt,{"model-value":e(u),"onUpdate:modelValue":l[10]||(l[10]=r=>A(u)?u.value=r:null),"items-per-page":e(j),"onUpdate:itemsPerPage":l[11]||(l[11]=r=>A(j)?j.value=r:null),page:e(J),"onUpdate:page":l[12]||(l[12]=r=>A(J)?J.value=r:null),"show-select":"","item-value":r=>r,loading:e(He),headers:V,items:e(Ke),"items-length":e(Ee),class:"text-no-wrap",locale:"fr","onUpdate:options":ze},{"item.code":a(({item:r})=>[e(K)("show","ramassage")?(m(),_(q,{key:0,variant:"text",onClick:oe=>Ye(r)},{default:a(()=>[C($(r.code),1)]),_:2},1032,["onClick"])):(m(),B("span",Wt,$(r.code),1))]),"item.statut":a(({item:r})=>[t(Be,ce(("statutInfos"in c?c.statutInfos:e(W))(r.statut),{density:"default",label:"",size:"small"}),null,16)]),"item.actions":a(({item:r})=>[r.statut=="EN_ATTENTE"&&e(K)("update","ramassage")?(m(),_(Te,{key:0,onClick:oe=>e(Ce).push("/ramassage/"+r.id)},{default:a(()=>[t(ue,{icon:"tabler-edit"})]),_:2},1032,["onClick"])):w("",!0),r.statut=="EN_ATTENTE"?(m(),_(Te,{key:1},{default:a(()=>[t(ue,{icon:"tabler-dots-vertical"}),t(qe,{activator:"parent"},{default:a(()=>[t(ee,null,{default:a(()=>[e(K)("delete","ramassage")?(m(),_(pe,{key:0,value:"delete","prepend-icon":"tabler-trash",onClick:oe=>Le(r)},{default:a(()=>l[22]||(l[22]=[C(" Delete ")])),_:2},1032,["onClick"])):w("",!0),t(pe,{"prepend-icon":"tabler-trash",onClick:oe=>X(r)},{default:a(()=>l[23]||(l[23]=[C(" Print ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)):w("",!0)]),bottom:a(()=>[t(Ze,{page:e(J),"onUpdate:page":l[9]||(l[9]=r=>A(J)?J.value=r:null),"items-per-page":e(j),"total-items":e(Ee)},null,8,["page","items-per-page","total-items"])]),_:1},8,["model-value","items-per-page","page","item-value","loading","items","items-length"]),t(ke,{modelValue:e(D),"onUpdate:modelValue":l[15]||(l[15]=r=>A(D)?D.value=r:null),persistent:"",class:"v-dialog-sm"},{default:a(()=>[t(et,{onClick:l[13]||(l[13]=r=>D.value=!e(D))}),t(ge,{title:"Êtes-vous sûr de vouloir supprimer le ramassage "+e(f).code+" ?"},{default:a(()=>[t(ie,{class:"d-flex justify-end gap-3 flex-wrap"},{default:a(()=>[t(q,{color:"secondary",variant:"tonal",onClick:l[14]||(l[14]=r=>D.value=!1)},{default:a(()=>l[24]||(l[24]=[C(" Non ")])),_:1}),t(q,{loading:e(p),onClick:We},{default:a(()=>l[25]||(l[25]=[C(" Oui ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])]),_:1}),e(s)?(m(),_(tt,{key:0,"is-print-group-colis":e(s),"onUpdate:isPrintGroupColis":l[16]||(l[16]=r=>A(s)?s.value=r:null),"vendeur-colis":e(L),items:e(v)},null,8,["is-print-group-colis","vendeur-colis","items"])):w("",!0),e(le)?(m(),_(Gt,{key:1,"is-show-item":e(le),"onUpdate:isShowItem":l[17]||(l[17]=r=>A(le)?le.value=r:null),items:e(u),onResetSelectedRows:Je},null,8,["is-show-item","items"])):w("",!0),e(se)?(m(),_(at,{id:e(xe),key:e(Re),"is-show-item":e(se),"onUpdate:isShowItem":l[18]||(l[18]=r=>A(se)?se.value=r:null),onFetchItems:e(Ae)},null,8,["id","is-show-item","onFetchItems"])):w("",!0)])}}};export{Pa as default};
