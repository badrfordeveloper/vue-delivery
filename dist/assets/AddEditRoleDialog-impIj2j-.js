import{V as N,r as S}from"./VForm-Dg9jF2bh.js";import{_ as A}from"./AppTextField-C8pU9PIj.js";import{_ as U}from"./DialogCloseBtn-BXOrtT6i.js";import{$ as P}from"./api-Dx5SAhyB.js";import{t as g}from"./toast-UA7yOy59.js";import{V as E}from"./VCard-CNbNQKcS.js";import{V as O}from"./VCardText-DsXbz0Qj.js";import{V as L}from"./VTable-mtkxK_Go.js";import{V as z}from"./VCheckbox-UHFyBl-6.js";import{aq as G,r as v,w as H,f as I,o as d,e as i,b as a,d as r,x as k,n as u,ak as C,c as b,F as D,h as R,ai as T,v as w}from"./index-ozxdH-7b.js";import{V as J}from"./VDialog-DzGsOeig.js";const K={class:"text-h4 text-center mb-2"},M={class:"text-h6"},Q={class:"d-flex justify-end"},W={class:"d-flex align-center justify-center gap-4"},ne={__name:"AddEditRoleDialog",props:{rolePermissions:{type:Object,required:!1,default:()=>({name:"",permissions:[]})},isDialogVisible:{type:Boolean,required:!0}},emits:["update:isDialogVisible","update:rolePermissions","fetchRoles"],async setup(B,{emit:$}){let p,x;const f=B,_=$,j=([p,x]=G(()=>P("/api/permissions").then(s=>s.data)),p=await p,x(),p),n=v(""),c=v("POST"),V=v(),m=v([]);H(()=>f.rolePermissions,s=>{var e;s&&((e=s.permissions)!=null&&e.length||s.name!="")?(c.value="PUT",n.value=s.name,m.value=s.permissions.map(t=>t.name)):c.value="POST"},{immediate:!0});const q=async()=>{const{valid:s}=await V.value.validate();if(s){let e="/api/roles";c.value=="PUT"&&(e="/api/roles/"+f.rolePermissions.id),P({method:c.value,url:e,data:{name:n.value,permissions:m.value}}).then(async t=>{var l;t.status===200&&(g.success(t.data),_("fetchRoles"),_("update:isDialogVisible",!1),(l=V.value)==null||l.reset())}).catch(t=>{if(t.response&&t.response.status===422){const l=t.response.data.errors;for(let o in l)g.error(`${o}: ${l[o].join(", ")}`)}})}},y=()=>{var s;_("update:isDialogVisible",!1),(s=V.value)==null||s.reset()};return(s,e)=>{const t=U,l=A;return d(),I(J,{width:s.$vuetify.display.smAndDown?"auto":900,"model-value":f.isDialogVisible,"onUpdate:modelValue":y},{default:i(()=>[a(t,{onClick:y}),a(E,{class:"pa-sm-10 pa-2"},{default:i(()=>[a(O,null,{default:i(()=>[r("h4",K,k(f.rolePermissions.name?"Edit":"Add New")+" Role ",1),e[5]||(e[5]=r("p",{class:"text-body-1 text-center mb-6"}," Set Role Permissions ",-1)),a(u(N),{ref_key:"refPermissionForm",ref:V},{default:i(()=>[a(l,{modelValue:u(n),"onUpdate:modelValue":e[0]||(e[0]=o=>C(n)?n.value=o:null),rules:["requiredValidator"in s?s.requiredValidator:u(S)],label:"Role Name",placeholder:"Enter Role Name"},null,8,["modelValue","rules"]),e[4]||(e[4]=r("h5",{class:"text-h5 my-6"}," Role Permissions ",-1)),a(L,{class:"permission-table text-no-wrap mb-6"},{default:i(()=>[(d(!0),b(D,null,R(u(j),o=>(d(),b("tr",{key:o.subject},[r("td",null,[r("h6",M,k(o.subject),1)]),(d(!0),b(D,null,R(o.actions,h=>(d(),b("td",{key:h.value},[r("div",Q,[a(z,{modelValue:u(m),"onUpdate:modelValue":e[1]||(e[1]=F=>C(m)?m.value=F:null),value:h.value,label:h.label},null,8,["modelValue","value","label"])])]))),128))]))),128))]),_:1}),r("div",W,[a(T,{onClick:q},{default:i(()=>e[2]||(e[2]=[w(" Submit ")])),_:1}),a(T,{color:"secondary",variant:"tonal",onClick:y},{default:i(()=>e[3]||(e[3]=[w(" Cancel ")])),_:1})])]),_:1},512)]),_:1})]),_:1})]),_:1},8,["width","model-value"])}}};export{ne as _};
