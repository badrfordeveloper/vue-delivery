import{s as C}from"./statutInfos-Dl5tZIw7.js";import{V as ue,_ as me,c as de}from"./VDataTableServer-BdHPifpA.js";import{_ as pe,a as I,s as w,e as R,b as ce}from"./AppDateTimePicker-BSYT4dEz.js";import{_ as fe}from"./AppTextField-C8pU9PIj.js";import{_ as ve}from"./AppSelect-QRYdQcLn.js";import{_ as ge}from"./AppAutocomplete-BgN-K_uu.js";import{c as Ve}from"./constants-CRfkYPs-.js";import{r,A as x,aq as N,w as ye,j as _e,Y as W,c as q,o as f,b as s,e as o,d as G,f as y,m as h,n as t,ak as u,v as U,x as L,s as j,ai as z}from"./index-ozxdH-7b.js";import{$ as E}from"./api-Dx5SAhyB.js";import{t as be}from"./toast-UA7yOy59.js";import{u as ke}from"./index-CuMPislM.js";import{V as Se}from"./VCardText-DsXbz0Qj.js";import{V as H,a as v}from"./VRow-pYCdNr-Y.js";import{a as Ie}from"./VList-DvQrXdhf.js";import{V as Y}from"./VDivider-CL3jlbdq.js";import{V as he}from"./VSpacer-BHnw5x-1.js";import{V as Te}from"./VChip-DhroVh_v.js";import{V as Oe}from"./VCard-CNbNQKcS.js";import{s as Ce}from"./startOfWeek-BX0W9kO8.js";import"./VDataTable-CWdQKmxs.js";import"./VSelect-CUsrGS1v.js";import"./VTextField-DxrlKLh1.js";import"./VInput-Dxr6NkQk.js";import"./VImg-DVerLASX.js";import"./forwardRefs-DWGaNmQL.js";import"./VOverlay-DrnfapjL.js";import"./VMenu-DghzHJlb.js";import"./VCheckboxBtn-CBFQvFM8.js";import"./VSelectionControl-Bxphu3hx.js";import"./VAvatar-CqlEylcw.js";import"./VTable-mtkxK_Go.js";import"./filter-bht-UASL.js";/* empty css              */import"./VSlideGroup-BJ0_jBgo.js";const we={class:"d-flex flex-wrap gap-4 ma-6"},xe={class:"d-flex gap-4 flex-wrap align-center"},Ue={key:1},ct={__name:"index",props:{statut:{type:String,required:!0}},async setup(J){let m,_;const K=J,T=r(!1),Q=r([{title:"Aujourd'hui",value:"today"},{title:"Hier",value:"yesterday"},{title:"La semaine dernière",value:"lastWeek"},{title:"Ce mois",value:"thisMonth"},{title:"Le mois précédent",value:"lastMonth"},{title:"Personnalisé",value:"custom"}]),X=x("gestionnaire","action"),n=r(),i=r(),g=r("today"),A=()=>{const l=new Date;switch(T.value=g.value==="custom",g.value){case"today":n.value=l.toISOString().split("T")[0],i.value=l.toISOString().split("T")[0];break;case"yesterday":const e=I(l,-1);n.value=e.toISOString().split("T")[0],i.value=e.toISOString().split("T")[0];break;case"lastWeek":n.value=Ce(I(l,-7)).toISOString().split("T")[0],i.value=ce(I(l,-7)).toISOString().split("T")[0];break;case"thisMonth":n.value=w(l).toISOString().split("T")[0],i.value=R(l).toISOString().split("T")[0];break;case"lastMonth":const c=I(w(l),-1);n.value=w(c).toISOString().split("T")[0],i.value=R(c).toISOString().split("T")[0];break}};A();const b=r(),Z=([m,_]=N(()=>E("/api/ramasseurs").then(l=>l.data)),m=await m,_(),m),ee=[{title:"code",key:"code",sortable:!1},{title:"Statut",key:"statut",sortable:!1},{title:"Livreur",key:"livreur",sortable:!1},{title:"Montant encaisse",key:"montant_encaisse",sortable:!1},{title:"Montant facturée",key:"montant_facture",sortable:!1},{title:"Frais Total",key:"frais_total",sortable:!1}],k=r(),V=r(),d=r(5),p=r(1),P=r(),B=r();ye(()=>K.statut,l=>{V.value=l},{immediate:!0});const S=r(!1),te=async()=>{let l="/api/generateLivreurFactures";S.value=!0,E({method:"POST",url:l}).then(async e=>{e.status===200&&(be.success(e.data),se()),S.value=!1}).catch(e=>{S.value=!1})},ae=l=>{var e,c;P.value=(e=l.sortBy[0])==null?void 0:e.key,B.value=(c=l.sortBy[0])==null?void 0:c.order},{data:F,error:Le,statusCode:Ae,isFetching:le,execute:se}=([m,_]=N(()=>ke(de("/api/factureLivreur",{query:{livreur_id:b,begin_date:n,end_date:i,code:k,statut:V,page:p,itemsPerPage:d,sortBy:P,orderBy:B}}))),m=await m,_(),m),oe=_e(),re=W(()=>F.value.items),M=W(()=>F.value.total);return(l,e)=>{const c=ge,O=ve,ne=fe,D=pe,ie=me;return f(),q("div",null,[s(Oe,{title:"Filtres",class:"mb-6 d-print-none"},{default:o(()=>[s(Se,null,{default:o(()=>[s(H,null,{default:o(()=>[t(X)?(f(),y(v,{key:0,cols:"12",sm:"3"},{default:o(()=>[s(c,{modelValue:t(b),"onUpdate:modelValue":e[0]||(e[0]=a=>u(b)?b.value=a:null),placeholder:"Livreurs",items:t(Z),clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1})):h("",!0),s(v,{cols:"12",sm:"3"},{default:o(()=>[s(O,{modelValue:t(V),"onUpdate:modelValue":e[1]||(e[1]=a=>u(V)?V.value=a:null),placeholder:"Statut",items:t(Ve),clearable:"","clear-icon":"tabler-x"},{item:o(({item:a,props:$})=>[s(Ie,j($,{title:("statutInfos"in l?l.statutInfos:t(C))(a.value).text}),null,16,["title"])]),selection:o(({item:a})=>[U(L(("statutInfos"in l?l.statutInfos:t(C))(a.value).text),1)]),_:1},8,["modelValue","items"])]),_:1}),s(v,{cols:"12",sm:"2"},{default:o(()=>[s(ne,{modelValue:t(k),"onUpdate:modelValue":e[2]||(e[2]=a=>u(k)?k.value=a:null),placeholder:"Code"},null,8,["modelValue"])]),_:1})]),_:1}),s(H,null,{default:o(()=>[s(v,{cols:"12",sm:"3"},{default:o(()=>[s(O,{modelValue:t(g),"onUpdate:modelValue":[e[3]||(e[3]=a=>u(g)?g.value=a:null),A],placeholder:"Plage de dates",items:t(Q),label:t(n)+" - "+t(i)},null,8,["modelValue","items","label"])]),_:1}),t(T)?(f(),y(v,{key:0,cols:"12",sm:"3"},{default:o(()=>[s(D,{modelValue:t(n),"onUpdate:modelValue":e[4]||(e[4]=a=>u(n)?n.value=a:null),label:"Début",placeholder:"date"},null,8,["modelValue"])]),_:1})):h("",!0),t(T)?(f(),y(v,{key:1,cols:"12",sm:"3"},{default:o(()=>[s(D,{modelValue:t(i),"onUpdate:modelValue":e[5]||(e[5]=a=>u(i)?i.value=a:null),label:"Fin",placeholder:"date"},null,8,["modelValue"])]),_:1})):h("",!0)]),_:1})]),_:1}),s(Y),G("div",we,[s(he),G("div",xe,[s(O,{modelValue:t(d),"onUpdate:modelValue":e[6]||(e[6]=a=>u(d)?d.value=a:null),items:[5,10,20,25,50]},null,8,["modelValue"]),t(x)("create","factureLivreur")?(f(),y(z,{key:0,color:"primary","prepend-icon":"tabler-plus",loading:t(S),onClick:te},{default:o(()=>e[10]||(e[10]=[U(" Génerer les factures ")])),_:1},8,["loading"])):h("",!0)])]),s(Y,{class:"mt-4"}),s(ue,{"items-per-page":t(d),"onUpdate:itemsPerPage":e[8]||(e[8]=a=>u(d)?d.value=a:null),page:t(p),"onUpdate:page":e[9]||(e[9]=a=>u(p)?p.value=a:null),loading:t(le),headers:ee,items:t(re),"items-length":t(M),class:"text-no-wrap",locale:"fr","onUpdate:options":ae},{"item.code":o(({item:a})=>[t(x)("show","factureLivreur")?(f(),y(z,{key:0,variant:"text",onClick:$=>t(oe).push("/factureLivreur/"+a.id)},{default:o(()=>[U(L(a.code),1)]),_:2},1032,["onClick"])):(f(),q("span",Ue,L(a.code),1))]),"item.statut":o(({item:a})=>[s(Te,j(("statutInfos"in l?l.statutInfos:t(C))(a.statut),{density:"default",label:"",size:"small"}),null,16)]),bottom:o(()=>[s(ie,{page:t(p),"onUpdate:page":e[7]||(e[7]=a=>u(p)?p.value=a:null),"items-per-page":t(d),"total-items":t(M)},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","page","loading","items","items-length"])]),_:1})])}}};export{ct as default};
