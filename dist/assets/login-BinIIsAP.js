import{V as B,r as v,$ as R}from"./VForm-B-RrgLOX.js";import{r as n,i as T,j as A,c as F,o as k,d as l,b as e,n as t,H as b,x as M,e as o,ah as S,f as E,m as N,ai as $,v as j,F as H,ax as g,av as P}from"./index-Cn4GOq09.js";import{_ as U}from"./AppTextField-CjMF6sBU.js";import{u as G,_ as K}from"./useAbility-BlDXNW5w.js";import{u as _,a as Y,b as z}from"./misc-mask-light-DP5G4dvq.js";import{V as J}from"./VNodeRenderer-BvAAXyPw.js";import{a as u,V as y}from"./VRow-_eMtTXOa.js";import{V as O}from"./VCard-C8xyqS8Y.js";import{V as w}from"./VCardText-oDAfMypB.js";import{V as Q}from"./VAlert-6CETvwmv.js";import{V as x}from"./VDivider-CSx1XzIQ.js";import"./toast-Cs2lwIGd.js";import"./VInput-DnGVuAhw.js";import"./VImg-BcxKOzCh.js";import"./forwardRefs-DWGaNmQL.js";import"./VTextField-Cf1CINQn.js";/* empty css              */import"./VAvatar-CUGtIZAw.js";const W="/assets/auth-v2-login-illustration-bordered-dark-cDkPk8mY.png",X="/assets/auth-v2-login-illustration-bordered-light-CIHqcIVA.png",Z="/assets/auth-v2-login-illustration-dark-ClExSVqL.png",ee="/assets/auth-v2-login-illustration-light-C4sKfRS1.png",ae={href:"javascript:void(0)"},te={class:"auth-logo d-flex align-center gap-x-3"},se={class:"auth-title"},oe={class:"position-relative bg-background w-100 me-0"},le=["src"],Ce={__name:"login",setup(re){const m=n(!1);_(ee,Z,X,W,!0);const C=_(z,Y),L=G(),V=T(),q=A(),i=n({email:"admin@gmail.com",password:"",remember:!1}),h=n(),c=n(!1),d=n(!1),f=n(!1),D=async()=>{try{d.value=!1,f.value=!0,R.post("/api/auth/login",{email:i.value.email,password:i.value.password}).then(async s=>{const{accessToken:a,userData:p,userAbilityRules:r}=s.data;g("userAbilityRules").value=r,L.update(r),g("userData").value=p,g("accessToken").value=a,d.value=!1,await P(()=>{q.replace(V.query.to?String(V.query.to):"/")})}).catch(s=>{s.status===403?(c.value=s.response.data.message,d.value=!0):s.status===422&&(c.value="Email ou mot de passe est incorrect",d.value=!0),console.log("error login")}).then(()=>{f.value=!1})}catch(s){console.error(s)}},I=()=>{var s;(s=h.value)==null||s.validate().then(({valid:a})=>{a&&D()})};return(s,a)=>{const p=U;return k(),F(H,null,[l("a",ae,[l("div",te,[e(t(J),{nodes:t(b).app.logo},null,8,["nodes"]),l("h1",se,M(t(b).app.title),1)])]),e(y,{"no-gutters":"",class:"auth-wrapper bg-surface"},{default:o(()=>[e(u,{md:"8",class:"d-none d-md-flex"},{default:o(()=>[l("div",oe,[l("img",{class:"auth-footer-mask flip-in-rtl",src:t(C),alt:"auth-footer-mask",height:"280",width:"100"},null,8,le)])]),_:1}),e(u,{cols:"12",md:"4",class:"auth-card-v2 d-flex align-center justify-center"},{default:o(()=>[e(O,{flat:"","max-width":500,class:"mt-12 mt-sm-0 pa-6"},{default:o(()=>[e(w,null,{default:o(()=>a[3]||(a[3]=[l("h4",{class:"text-h4 mb-1"}," Login ",-1)])),_:1}),e(w,null,{default:o(()=>[e(B,{ref_key:"refVForm",ref:h,onSubmit:S(I,["prevent"])},{default:o(()=>[e(y,null,{default:o(()=>[t(d)?(k(),E(Q,{key:0,title:t(c),type:"error"},null,8,["title"])):N("",!0),e(u,{cols:"12"},{default:o(()=>[e(p,{modelValue:t(i).email,"onUpdate:modelValue":a[0]||(a[0]=r=>t(i).email=r),rules:["requiredValidator"in s?s.requiredValidator:t(v)],autofocus:"",label:"Email",type:"email",placeholder:"test@gmail.com"},null,8,["modelValue","rules"])]),_:1}),e(u,{cols:"12"},{default:o(()=>[e(p,{modelValue:t(i).password,"onUpdate:modelValue":a[1]||(a[1]=r=>t(i).password=r),rules:["requiredValidator"in s?s.requiredValidator:t(v)],label:"Mot de passe",placeholder:"············",type:t(m)?"text":"password",autocomplete:"password","append-inner-icon":t(m)?"tabler-eye-off":"tabler-eye","onClick:appendInner":a[2]||(a[2]=r=>m.value=!t(m))},null,8,["modelValue","rules","type","append-inner-icon"]),a[5]||(a[5]=l("div",{class:"my-5"},null,-1)),e($,{loading:t(f),block:"",type:"submit"},{default:o(()=>a[4]||(a[4]=[j(" Login ")])),_:1},8,["loading"])]),_:1}),e(u,{cols:"12",class:"d-flex align-center"},{default:o(()=>[e(x),a[6]||(a[6]=l("span",{class:"mx-4"},"or",-1)),e(x)]),_:1}),e(u,{cols:"12",class:"text-center"},{default:o(()=>[e(K)]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})],64)}}};export{Ce as default};
