import{s as v}from"./statutInfos-BBtLoj05.js";import{V as Y,a as $,b as J,c as C,d as st,p as at,f as lt,_ as ot}from"./VTabs-Ecx7Hz-1.js";import{r as O,V as nt,$ as B}from"./VForm-DnlssNIV.js";import{_ as rt}from"./AppTextarea-BYSUsSWJ.js";import{_ as ut}from"./AppTextField-Ko2bKItW.js";import{r as b,w as K,A as P,Y as it,c as w,n as l,o as _,m as G,F as X,h as Z,f as tt,e as a,v as c,x as d,ai as M,b as s,d as t,i as dt,aq as mt,as as ft,s as I,ak as D,$ as pt}from"./index-D7yJXdJy.js";import{t as T}from"./toast-BvykrbAm.js";import{V,a as f}from"./VRow-CUggEZk2.js";import{V as ct}from"./VFileInput-tseUwLXV.js";import{V as k}from"./VCard-BzgJ_axc.js";import{V as g}from"./VCardText-DG6BKODZ.js";import{V as A}from"./VChip-ft8FN7z7.js";import{V as Q,a as z}from"./VDataTable-PwivpTYX.js";import"./VOverlay-COMBmcfa.js";import"./forwardRefs-DWGaNmQL.js";import"./VImg-CAZDB8sp.js";import"./DialogCloseBtn-hjQAM4Ms.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VDialog-QHPGG0zZ.js";import"./VList-DiSHM2Z9.js";import"./VAvatar-BA4myzIO.js";import"./VDivider-CS0fj1z-.js";import"./VInput-9emClv3n.js";import"./VTextField-DQEf5zjE.js";/* empty css              */import"./VSelect-DgF_GPzl.js";import"./VMenu-CpeeX_P2.js";import"./filter-DdGIDvpm.js";const bt={key:0,class:"text-center"},_t={key:0},yt={key:1},vt={class:"text-center"},Vt={key:0},xt={__name:"ActionsLivreurFacture",props:{currentStatut:{type:String,required:!0},item:{type:Object,required:!0},id:{type:Number,required:!0}},emits:["getItemData"],setup(H,{emit:W}){const y=H,F=W,R=b({}),h=b(""),n=b(!1),x=b(),u=b({id:null,statut:"",commentaire:"",montant:"",file:""});K(()=>y.currentStatut,r=>{h.value=r},{immediate:!0}),K(()=>y.item,r=>{R.value=r},{immediate:!0});const m=b(""),S=r=>{n.value=!0,u.value.statut=r},q=async()=>{const{valid:r}=await x.value.validate();r&&await U(u.value.statut)},U=async r=>{u.value.statut=r,u.value.id=y.id,m.value=r;const o=new FormData;o.append("file",u.value.file),o.append("id",u.value.id),o.append("statut",u.value.statut),o.append("commentaire",u.value.commentaire),o.append("date",u.value.date),B({method:"POST",url:"/api/updateStatutFactureLivreur",data:o,headers:{"Content-Type":"multipart/form-data"}}).then(async e=>{e.status===200&&(T.success(e.data),r!="COMMENTAIRE"&&(h.value=r),n.value=!1,F("getItemData")),m.value=""}).catch(e=>{m.value="",e.response&&e.response.status===422?T.error(e.response.data.message):T.error("something wrong")})};P("livreur","action");const N=P("gestionnaire","action"),E=it(()=>{let r=[];return r.push({text:"Commentaire",color:"secondary",statut:"COMMENTAIRE"}),["EN_ATTENTE"].includes(h.value)&&N&&r.push({...v("FACTURE"),statut:"FACTURE"}),["FACTURE"].includes(h.value)&&N&&r.push({...v("VALIDE"),statut:"VALIDE"}),r});return(r,o)=>{const e=ut,L=rt;return l(n)?(_(),w("div",yt,[s(nt,{ref_key:"refForm",ref:x,class:"mt-3"},{default:a(()=>[t("p",vt," Statut à envoyer : "+d(("statutInfos"in r?r.statutInfos:l(v))(l(u).statut).text),1),["FACTURE"].includes(l(u).statut)?(_(),w("div",Vt,[s(V,{class:"d-flex align-center justify-center"},{default:a(()=>[s(f,{md:"6",cols:"12"},{default:a(()=>[s(ct,{modelValue:l(u).file,"onUpdate:modelValue":o[0]||(o[0]=p=>l(u).file=p),rules:["requiredValidator"in r?r.requiredValidator:l(O)],accept:"image/*",label:"Recu"},null,8,["modelValue","rules"])]),_:1})]),_:1}),s(V,{class:"d-flex align-center justify-center"},{default:a(()=>[s(f,{md:"6",cols:"12"},{default:a(()=>[s(e,{modelValue:l(u).montant,"onUpdate:modelValue":o[1]||(o[1]=p=>l(u).montant=p),rules:["requiredValidator"in r?r.requiredValidator:l(O)],placeholder:"Montant",label:"Montant",type:"number"},null,8,["modelValue","rules"])]),_:1})]),_:1})])):G("",!0),t("div",null,[s(V,{class:"d-flex align-center justify-center"},{default:a(()=>[s(f,{md:"6",cols:"12"},{default:a(()=>[s(L,{modelValue:l(u).commentaire,"onUpdate:modelValue":o[2]||(o[2]=p=>l(u).commentaire=p),rows:"2","row-height":"20",label:"Commentaire",rules:["COMMENTAIRE"].includes(l(u).statut)?["requiredValidator"in r?r.requiredValidator:l(O)]:[],placeholder:"Commentaire"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),s(V,null,{default:a(()=>[s(f,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:a(()=>[s(M,{color:"secondary",onClick:o[3]||(o[3]=p=>n.value=!1)},{default:a(()=>o[4]||(o[4]=[c(" retour ")])),_:1}),s(M,{loading:l(m)==l(u).statut,onClick:q},{default:a(()=>o[5]||(o[5]=[c(" Envoyer ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},512)])):(_(),w("div",bt,[(_(!0),w(X,null,Z(l(E),(p,j)=>(_(),tt(M,{key:j,color:p.color,class:"ma-1",loading:l(m)==p.statut,onClick:i=>S(p.statut)},{default:a(()=>[c(d(p.text),1)]),_:2},1032,["color","loading","onClick"]))),128)),l(E).length==0?(_(),w("div",_t," Aucune action requise ")):G("",!0)]))}}},gt={class:"text-h6 text-no-wrap mb-2"},wt={class:"text-body-1 mb-2"},ht={class:"text-h6 text-no-wrap mb-2"},Ct={class:"text-body-1 mb-2"},It={class:"text-h6 text-no-wrap mb-2"},kt={class:"text-body-1 mb-2"},At={class:"text-h6 text-no-wrap mb-2"},Tt={class:"text-body-1 mb-2"},Ft={class:"text-h6 text-no-wrap mb-2"},Nt={class:"text-body-1 mb-2"},Et={class:"text-body-1 mb-2"},$t={class:"text-body-1 mb-2"},Dt={class:"text-body-1 mb-2"},Mt={class:"text-body-1 mb-2"},Rt={class:"text-body-1 mb-2"},St={class:"text-body-1 mb-2"},qt={class:"text-body-1 mb-2"},Ut={class:"text-body-1 mb-2"},Lt={class:"text-body-1 mb-2"},jt={class:"text-body-1 mb-2"},Ot={class:"text-body-1 mb-2"},zt={class:"text-body-1 mb-2"},Bt={class:"text-body-1 mb-2"},Pt={key:0},Ve={__name:"[id]",props:{id:{type:Object,required:!1}},emits:["update:isShowItem","fetchItems"],async setup(H,{emit:W}){let y,F;const R=dt();let h={id:"",nom_vendeur:"",tel_vendeur:"",tarif_id:"",commentaire_vendeur:"",code_ramassage:"",frais_livreur:"",adresse:"",livreur:"",livreur_id:"",tel_livreur:"",statut:"",vendeur:"",created_at:"",colisHistories:[]};[y,F]=mt(()=>B("/api/ramasseurs").then(o=>o.data)),y=await y,F();const n=b(structuredClone(ft(h))),x=b(!1),u=async()=>{x.value=!0,await B("/api/factureLivreur/"+R.params.id).then(async o=>{o.status===200&&(n.value=o.data),x.value=!1}).catch(o=>{x.value=!1,o.response&&o.response.status===422?T.error(o.response.data.message):T.error("something wrong")})};u(),P("gestionnaire","action");const m=b("Actions"),S=["tabler-adjustments-share","tabler-logs"],q=o=>{if(o=="")return o;const e=at(o);return lt(e,"yyyy-MM-dd")},U=()=>{window.print()};b(!1);const N=[{title:"Code",key:"code",sortable:!1},{title:"Statut",key:"statut",sortable:!1},{title:"frais",key:"frais_livreur",sortable:!1},{title:"Montant",key:"montant",sortable:!1}],E=[{title:"Code",key:"code",sortable:!1},{title:"Statut",key:"statut",sortable:!1},{title:"frais",key:"frais_ramasseur",sortable:!1}],r=[{title:"Code",key:"code",sortable:!1},{title:"Statut",key:"statut",sortable:!1},{title:"frais",key:"frais_ramasseur",sortable:!1}];return(o,e)=>{const L=xt,p=st,j=ot;return _(),tt(j,{loading:l(x),"no-actions":""},{default:a(()=>[s(V,{class:"row-print"},{default:a(()=>[s(f,{cols:"10",class:"col-print"},{default:a(()=>[s(k,null,{default:a(()=>[s(g,{class:"print-area"},{default:a(()=>[s(V,null,{default:a(()=>[s(f,{cols:"12"},{default:a(()=>[s(k,{title:"Informations Facture"},{default:a(()=>[s(g,null,{default:a(()=>[s(V,null,{default:a(()=>[s(f,{cols:"12",lg:"4"},{default:a(()=>[t("h6",gt,[e[5]||(e[5]=c(" Code : ")),t("span",wt,d(l(n).code),1)])]),_:1}),s(f,{cols:"12",lg:"4"},{default:a(()=>[t("h6",ht,[e[6]||(e[6]=c(" Livreur : ")),t("span",Ct,d(l(n).livreur),1)])]),_:1}),s(f,{cols:"12",lg:"4"},{default:a(()=>[t("h6",It,[e[7]||(e[7]=c(" Tel Livreur : ")),t("span",kt,d(l(n).tel_livreur),1)])]),_:1}),s(f,{cols:"12",lg:"4"},{default:a(()=>[t("h6",At,[e[8]||(e[8]=c(" Statut : ")),t("span",Tt,[s(A,I(("statutInfos"in o?o.statutInfos:l(v))(l(n).statut),{density:"default",label:"",size:"small"}),null,16)])])]),_:1}),s(f,{cols:"12",lg:"4"},{default:a(()=>[t("h6",Ft,[e[9]||(e[9]=c(" Date : ")),t("span",Nt,d(q(l(n).created_at)),1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(V,null,{default:a(()=>[s(f,{cols:"12",lg:"6"},{default:a(()=>[s(k,{title:"Nombres"},{default:a(()=>[s(g,null,{default:a(()=>[s(Q,{class:"billing-address-table"},{default:a(()=>[t("tr",null,[e[10]||(e[10]=t("td",null,[t("h6",{class:"text-h6 text-no-wrap mb-2"}," Nombre Total : ")],-1)),t("td",null,[t("p",Et,d(l(n).nombre_total),1)])]),t("tr",null,[e[11]||(e[11]=t("td",null,[t("h6",{class:"text-h6 text-no-wrap mb-2"}," Nombre des colis livrés : ")],-1)),t("td",null,[t("p",$t,d(l(n).nombre_livre),1)])]),t("tr",null,[e[12]||(e[12]=t("td",null,[t("h6",{class:"text-h6 text-no-wrap mb-2"}," Nombre des colis livrés partiellement : ")],-1)),t("td",null,[t("p",Dt,d(l(n).nombre_livre_partiellement),1)])]),t("tr",null,[e[13]||(e[13]=t("td",null,[t("h6",{class:"text-h6 text-no-wrap mb-2"}," Nombre des colis refusés : ")],-1)),t("td",null,[t("p",Mt,d(l(n).nombre_refuse),1)])]),t("tr",null,[e[14]||(e[14]=t("td",null,[t("h6",{class:"text-h6 text-no-wrap mb-2"}," Nombre des colis annulés : ")],-1)),t("td",null,[t("p",Rt,d(l(n).nombre_annule),1)])]),t("tr",null,[e[15]||(e[15]=t("td",null,[t("h6",{class:"text-h6 text-no-wrap mb-2"}," Nombre des ramassages : ")],-1)),t("td",null,[t("p",St,d(l(n).nombre_ramassage),1)])]),t("tr",null,[e[16]||(e[16]=t("td",null,[t("h6",{class:"text-h6 text-no-wrap mb-2"}," Nombre des retours : ")],-1)),t("td",null,[t("p",qt,d(l(n).nombre_retour),1)])])]),_:1})]),_:1})]),_:1})]),_:1}),s(f,{cols:"12",lg:"6"},{default:a(()=>[s(k,{title:"Montants"},{default:a(()=>[s(g,null,{default:a(()=>[s(Q,{class:"billing-address-table"},{default:a(()=>[t("tr",null,[e[17]||(e[17]=t("td",null,[t("h6",{class:"text-h6 text-no-wrap mb-2"}," Mantant facturé : ")],-1)),t("td",null,[t("p",Ut,d(l(n).montant_facture),1)])]),t("tr",null,[e[18]||(e[18]=t("td",null,[t("h6",{class:"text-h6 text-no-wrap mb-2"}," Mantant encaissé : ")],-1)),t("td",null,[t("p",Lt,d(l(n).montant_encaisse),1)])]),t("tr",null,[e[19]||(e[19]=t("td",null,[t("h6",{class:"text-h6 text-no-wrap mb-2"}," Frais Total: ")],-1)),t("td",null,[t("p",jt,d(l(n).frais_total),1)])]),t("tr",null,[e[20]||(e[20]=t("td",null,[t("h6",{class:"text-h6 text-no-wrap mb-2"}," Frais des colis : ")],-1)),t("td",null,[t("p",Ot,d(l(n).frais_colis),1)])]),t("tr",null,[e[21]||(e[21]=t("td",null,[t("h6",{class:"text-h6 text-no-wrap mb-2"}," Frais de ramassage : ")],-1)),t("td",null,[t("p",zt,d(l(n).frais_ramassage),1)])]),t("tr",null,[e[22]||(e[22]=t("td",null,[t("h6",{class:"text-h6 text-no-wrap mb-2"}," Frais de retour : ")],-1)),t("td",null,[t("p",Bt,d(l(n).frais_retour),1)])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(g,{class:"d-print-none"},{default:a(()=>[s(Y,{modelValue:l(m),"onUpdate:modelValue":e[0]||(e[0]=i=>D(m)?m.value=i:null),grow:"",class:"disable-tab-transition",stacked:""},{default:a(()=>[(_(),w(X,null,Z(S,(i,et)=>s($,{key:et},{default:a(()=>[s(pt,{size:"40",icon:i},null,8,["icon"])]),_:2},1024)),64))]),_:1},8,["modelValue"]),s(J,{modelValue:l(m),"onUpdate:modelValue":e[2]||(e[2]=i=>D(m)?m.value=i:null),class:"mt-3"},{default:a(()=>[s(C,null,{default:a(()=>[s(L,{id:l(n).id,"current-statut":l(n).statut,onGetItemData:e[1]||(e[1]=i=>u(l(n).id))},null,8,["id","current-statut"])]),_:1}),s(C,null,{default:a(()=>[s(p,{histories:l(n).histories},null,8,["histories"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),s(g,{class:"d-print-none"},{default:a(()=>[s(Y,{modelValue:l(m),"onUpdate:modelValue":e[3]||(e[3]=i=>D(m)?m.value=i:null),grow:"",class:"disable-tab-transition",stacked:""},{default:a(()=>[s($,null,{default:a(()=>e[23]||(e[23]=[c(" Colis ")])),_:1}),s($,null,{default:a(()=>e[24]||(e[24]=[c(" ramassages ")])),_:1}),s($,null,{default:a(()=>e[25]||(e[25]=[c(" retours ")])),_:1})]),_:1},8,["modelValue"]),s(J,{modelValue:l(m),"onUpdate:modelValue":e[4]||(e[4]=i=>D(m)?m.value=i:null),class:"mt-3"},{default:a(()=>[s(C,null,{default:a(()=>[s(z,{headers:N,items:l(n).colis,"items-per-page":10},{"item.statut":a(({item:i})=>[s(A,I(("statutInfos"in o?o.statutInfos:l(v))(i.statut),{density:"default",label:"",size:"small"}),null,16),i.statut_retour?(_(),w("span",Pt,[e[26]||(e[26]=c(" - ")),s(A,I(("statutInfos"in o?o.statutInfos:l(v))(i.statut_retour),{density:"default",label:"",size:"small"}),null,16)])):G("",!0)]),_:1},8,["items"])]),_:1}),s(C,null,{default:a(()=>[s(z,{headers:E,items:l(n).ramassages,"items-per-page":10},{"item.statut":a(({item:i})=>[s(A,I(("statutInfos"in o?o.statutInfos:l(v))(i.statut),{density:"default",label:"",size:"small"}),null,16)]),_:1},8,["items"])]),_:1}),s(C,null,{default:a(()=>[s(z,{headers:r,items:l(n).retours,"items-per-page":10},{"item.statut":a(({item:i})=>[s(A,I(("statutInfos"in o?o.statutInfos:l(v))(i.statut),{density:"default",label:"",size:"small"}),null,16)]),_:1},8,["items"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),s(f,{cols:"2",class:"d-print-none"},{default:a(()=>[s(k,null,{default:a(()=>[s(g,null,{default:a(()=>[s(M,{color:"info",class:"w-100",onClick:U},{default:a(()=>e[27]||(e[27]=[c(" Print ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])}}};export{Ve as default};
