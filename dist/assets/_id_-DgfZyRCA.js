import{s as x}from"./statutInfos-BWJ2EfQa.js";import{V as J,a as $,b as K,c as k,d as at,p as lt,f as ot,_ as nt}from"./VTabs-69nHgKJg.js";import{r as j,V as rt,$ as B}from"./VForm-Cq3Ud8bc.js";import{_ as ut}from"./AppTextarea-CMC7IWXa.js";import{_ as it}from"./AppTextField-DUGgtO2g.js";import{r as b,w as Q,A as P,Y as dt,c as y,n as l,o as v,m as G,F as Z,h as tt,f as et,e as a,v as c,x as m,ai as M,b as e,d as t,i as mt,aq as ft,as as pt,s as A,ak as D,$ as ct}from"./index-AFclKSR7.js";import{t as E}from"./toast-DO2v-l4e.js";import{V as w,a as f}from"./VRow-CHOMieTn.js";import{V as _t}from"./VFileInput-DaNF7VRQ.js";import{V as T}from"./VCard-DvDMA-YT.js";import{V as C}from"./VCardText-MbsNng7n.js";import{V as F}from"./VChip-Cf7qKl4a.js";import{V as X,a as z}from"./VDataTable-ByykQiB5.js";import"./VOverlay-5K06fWrB.js";import"./forwardRefs-DWGaNmQL.js";import"./VImg-BIM37CCd.js";import"./DialogCloseBtn-DzYXhcYP.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VDialog-BcDL8NDF.js";import"./VList-CCzHfilh.js";import"./VAvatar-BLWrssMY.js";import"./VDivider-Bs5rWrNF.js";import"./VInput-tctzcLUr.js";import"./VTextField-D0JQPs88.js";/* empty css              */import"./VSelect-BlxSZfVV.js";import"./VMenu-CpEhrxaz.js";import"./filter-DtFQEqnM.js";const bt={key:0,class:"text-center"},vt={key:0},yt={key:1},Vt={class:"text-center"},gt={key:0},xt={__name:"ActionsLivreurFacture",props:{currentStatut:{type:String,required:!0},item:{type:Object,required:!0},id:{type:Number,required:!0}},emits:["getItemData"],setup(H,{emit:W}){const V=H,N=W,q=b({}),I=b(""),n=b(!1),h=b(),u=b({id:null,statut:"",commentaire:"",montant:"",file:""});Q(()=>V.currentStatut,r=>{I.value=r},{immediate:!0}),Q(()=>V.item,r=>{q.value=r},{immediate:!0});const _=b(""),g=r=>{n.value=!0,u.value.statut=r},U=async()=>{const{valid:r}=await h.value.validate();r&&await L(u.value.statut)},L=async r=>{u.value.statut=r,u.value.id=V.id,_.value=r;const d=new FormData;d.append("file",u.value.file),d.append("id",u.value.id),d.append("statut",u.value.statut),d.append("commentaire",u.value.commentaire),d.append("montant",u.value.montant),B({method:"POST",url:"/api/updateStatutFactureLivreur",data:d,headers:{"Content-Type":"multipart/form-data"}}).then(async o=>{o.status===200&&(E.success(o.data),r!="COMMENTAIRE"&&(I.value=r),n.value=!1,N("getItemData")),_.value=""}).catch(o=>{_.value="",o.response&&o.response.status===422?E.error(o.response.data.message):E.error("something wrong")})};P("livreur","action");const S=P("gestionnaire","action"),R=dt(()=>{let r=[];return r.push({text:"Commentaire",color:"secondary",statut:"COMMENTAIRE"}),["EN_ATTENTE"].includes(I.value)&&S&&r.push({...x("FACTURE"),statut:"FACTURE"}),["FACTURE"].includes(I.value)&&S&&r.push({...x("VALIDE"),statut:"VALIDE"}),r});return(r,d)=>{const o=it,s=ut;return l(n)?(v(),y("div",yt,[e(rt,{ref_key:"refForm",ref:h,class:"mt-3"},{default:a(()=>[t("p",Vt," Statut à envoyer : "+m(("statutInfos"in r?r.statutInfos:l(x))(l(u).statut).text),1),["FACTURE"].includes(l(u).statut)?(v(),y("div",gt,[e(w,{class:"d-flex align-center justify-center"},{default:a(()=>[e(f,{md:"6",cols:"12"},{default:a(()=>[e(_t,{modelValue:l(u).file,"onUpdate:modelValue":d[0]||(d[0]=p=>l(u).file=p),rules:["requiredValidator"in r?r.requiredValidator:l(j)],accept:"image/*",label:"Recu"},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(w,{class:"d-flex align-center justify-center"},{default:a(()=>[e(f,{md:"6",cols:"12"},{default:a(()=>[e(o,{modelValue:l(u).montant,"onUpdate:modelValue":d[1]||(d[1]=p=>l(u).montant=p),rules:["requiredValidator"in r?r.requiredValidator:l(j)],placeholder:"Montant",label:"Montant",type:"number"},null,8,["modelValue","rules"])]),_:1})]),_:1})])):G("",!0),t("div",null,[e(w,{class:"d-flex align-center justify-center"},{default:a(()=>[e(f,{md:"6",cols:"12"},{default:a(()=>[e(s,{modelValue:l(u).commentaire,"onUpdate:modelValue":d[2]||(d[2]=p=>l(u).commentaire=p),rows:"2","row-height":"20",label:"Commentaire",rules:["COMMENTAIRE"].includes(l(u).statut)?["requiredValidator"in r?r.requiredValidator:l(j)]:[],placeholder:"Commentaire"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),e(w,null,{default:a(()=>[e(f,{cols:"12",class:"d-flex flex-wrap justify-center gap-4"},{default:a(()=>[e(M,{color:"secondary",onClick:d[3]||(d[3]=p=>n.value=!1)},{default:a(()=>d[4]||(d[4]=[c(" retour ")])),_:1}),e(M,{loading:l(_)==l(u).statut,onClick:U},{default:a(()=>d[5]||(d[5]=[c(" Envoyer ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},512)])):(v(),y("div",bt,[(v(!0),y(Z,null,tt(l(R),(p,O)=>(v(),et(M,{key:O,color:p.color,class:"ma-1",loading:l(_)==p.statut,onClick:Y=>g(p.statut)},{default:a(()=>[c(m(p.text),1)]),_:2},1032,["color","loading","onClick"]))),128)),l(R).length==0?(v(),y("div",vt," Aucune action requise ")):G("",!0)]))}}},wt={class:"text-h6 text-no-wrap mb-2"},ht={class:"text-body-1 mb-2"},Ct={class:"text-h6 text-no-wrap mb-2"},It={class:"text-body-1 mb-2"},kt={class:"text-h6 text-no-wrap mb-2"},At={class:"text-body-1 mb-2"},Tt={class:"text-h6 text-no-wrap mb-2"},Ft={class:"text-body-1 mb-2"},Et={class:"text-h6 text-no-wrap mb-2"},Nt={class:"text-body-1 mb-2"},St={class:"text-body-1 mb-2"},Rt={class:"text-body-1 mb-2"},$t={class:"text-body-1 mb-2"},Dt={class:"text-body-1 mb-2"},Mt={class:"text-body-1 mb-2"},qt={class:"text-body-1 mb-2"},Ut={class:"text-body-1 mb-2"},Lt={class:"text-body-1 mb-2"},Ot={class:"text-body-1 mb-2"},jt={class:"text-body-1 mb-2"},zt={class:"text-body-1 mb-2"},Bt={class:"text-body-1 mb-2"},Pt={class:"text-body-1 mb-2"},Gt={key:0},Ht={key:0},Wt={key:1},we={__name:"[id]",props:{id:{type:Object,required:!1}},emits:["update:isShowItem","fetchItems"],async setup(H,{emit:W}){let V,N;const q=mt();let I={id:"",nom_vendeur:"",tel_vendeur:"",tarif_id:"",commentaire_vendeur:"",code_ramassage:"",frais_livreur:"",adresse:"",livreur:"",livreur_id:"",tel_livreur:"",statut:"",vendeur:"",created_at:"",colisHistories:[]};[V,N]=ft(()=>B("/api/ramasseurs").then(o=>o.data)),V=await V,N();const n=b(structuredClone(pt(I))),h=b(!1),u=async()=>{h.value=!0,await B("/api/factureLivreur/"+q.params.id).then(async o=>{o.status===200&&(n.value=o.data),h.value=!1}).catch(o=>{h.value=!1,o.response&&o.response.status===422?E.error(o.response.data.message):E.error("something wrong")})};u(),P("gestionnaire","action");const _=b("Actions"),g=b("COLIS"),U=["tabler-adjustments-share","tabler-logs"],L=o=>{if(o=="")return o;const s=lt(o);return ot(s,"yyyy-MM-dd")},S=()=>{window.print()};b(!1);const R=[{title:"Code",key:"code",sortable:!1},{title:"Statut",key:"statut",sortable:!1},{title:"frais",key:"frais_livreur",sortable:!1},{title:"Montant",key:"montant",sortable:!1}],r=[{title:"Code",key:"code",sortable:!1},{title:"Statut",key:"statut",sortable:!1},{title:"frais",key:"frais_ramasseur",sortable:!1}],d=[{title:"Code",key:"code",sortable:!1},{title:"Statut",key:"statut",sortable:!1},{title:"frais",key:"frais_ramasseur",sortable:!1}];return(o,s)=>{const p=xt,O=at,Y=nt;return v(),et(Y,{loading:l(h),"no-actions":""},{default:a(()=>[e(w,{class:"row-print"},{default:a(()=>[e(f,{cols:"12",lg:"10",class:"col-print"},{default:a(()=>[e(T,null,{default:a(()=>[e(C,{class:"print-area"},{default:a(()=>[e(w,null,{default:a(()=>[e(f,{cols:"12"},{default:a(()=>[e(T,{title:"Informations Facture"},{default:a(()=>[e(C,null,{default:a(()=>[e(w,null,{default:a(()=>[e(f,{cols:"12",lg:"4"},{default:a(()=>[t("h6",wt,[s[5]||(s[5]=c(" Code : ")),t("span",ht,m(l(n).code),1)])]),_:1}),e(f,{cols:"12",lg:"4"},{default:a(()=>[t("h6",Ct,[s[6]||(s[6]=c(" Livreur : ")),t("span",It,m(l(n).livreur),1)])]),_:1}),e(f,{cols:"12",lg:"4"},{default:a(()=>[t("h6",kt,[s[7]||(s[7]=c(" Tel Livreur : ")),t("span",At,m(l(n).tel_livreur),1)])]),_:1}),e(f,{cols:"12",lg:"4"},{default:a(()=>[t("h6",Tt,[s[8]||(s[8]=c(" Statut : ")),t("span",Ft,[e(F,A(("statutInfos"in o?o.statutInfos:l(x))(l(n).statut),{density:"default",label:"",size:"small"}),null,16)])])]),_:1}),e(f,{cols:"12",lg:"4"},{default:a(()=>[t("h6",Et,[s[9]||(s[9]=c(" Date : ")),t("span",Nt,m(L(l(n).created_at)),1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(w,null,{default:a(()=>[e(f,{cols:"12",lg:"6"},{default:a(()=>[e(T,{title:"Nombres"},{default:a(()=>[e(C,null,{default:a(()=>[e(X,{class:"billing-address-table"},{default:a(()=>[t("tr",null,[s[10]||(s[10]=t("td",null,[t("h6",{class:"text-h6 text-no-wrap mb-2"}," Nombre Total : ")],-1)),t("td",null,[t("p",St,m(l(n).nombre_total),1)])]),t("tr",null,[s[11]||(s[11]=t("td",null,[t("h6",{class:"text-h6 text-no-wrap mb-2"}," Nombre des colis livrés : ")],-1)),t("td",null,[t("p",Rt,m(l(n).nombre_livre),1)])]),t("tr",null,[s[12]||(s[12]=t("td",null,[t("h6",{class:"text-h6 text-no-wrap mb-2"}," Nombre des colis livrés partiellement : ")],-1)),t("td",null,[t("p",$t,m(l(n).nombre_livre_partiellement),1)])]),t("tr",null,[s[13]||(s[13]=t("td",null,[t("h6",{class:"text-h6 text-no-wrap mb-2"}," Nombre des colis refusés : ")],-1)),t("td",null,[t("p",Dt,m(l(n).nombre_refuse),1)])]),t("tr",null,[s[14]||(s[14]=t("td",null,[t("h6",{class:"text-h6 text-no-wrap mb-2"}," Nombre des colis annulés : ")],-1)),t("td",null,[t("p",Mt,m(l(n).nombre_annule),1)])]),t("tr",null,[s[15]||(s[15]=t("td",null,[t("h6",{class:"text-h6 text-no-wrap mb-2"}," Nombre des ramassages : ")],-1)),t("td",null,[t("p",qt,m(l(n).nombre_ramassage),1)])]),t("tr",null,[s[16]||(s[16]=t("td",null,[t("h6",{class:"text-h6 text-no-wrap mb-2"}," Nombre des retours : ")],-1)),t("td",null,[t("p",Ut,m(l(n).nombre_retour),1)])])]),_:1})]),_:1})]),_:1})]),_:1}),e(f,{cols:"12",lg:"6"},{default:a(()=>[e(T,{title:"Montants"},{default:a(()=>[e(C,null,{default:a(()=>[e(X,{class:"billing-address-table"},{default:a(()=>[t("tr",null,[s[17]||(s[17]=t("td",null,[t("h6",{class:"text-h6 text-no-wrap mb-2"}," Mantant facturé : ")],-1)),t("td",null,[t("p",Lt,m(l(n).montant_facture),1)])]),t("tr",null,[s[18]||(s[18]=t("td",null,[t("h6",{class:"text-h6 text-no-wrap mb-2"}," Mantant encaissé : ")],-1)),t("td",null,[t("p",Ot,m(l(n).montant_encaisse),1)])]),t("tr",null,[s[19]||(s[19]=t("td",null,[t("h6",{class:"text-h6 text-no-wrap mb-2"}," Frais Total: ")],-1)),t("td",null,[t("p",jt,m(l(n).frais_total),1)])]),t("tr",null,[s[20]||(s[20]=t("td",null,[t("h6",{class:"text-h6 text-no-wrap mb-2"}," Frais des colis : ")],-1)),t("td",null,[t("p",zt,m(l(n).frais_colis),1)])]),t("tr",null,[s[21]||(s[21]=t("td",null,[t("h6",{class:"text-h6 text-no-wrap mb-2"}," Frais de ramassage : ")],-1)),t("td",null,[t("p",Bt,m(l(n).frais_ramassage),1)])]),t("tr",null,[s[22]||(s[22]=t("td",null,[t("h6",{class:"text-h6 text-no-wrap mb-2"}," Frais de retour : ")],-1)),t("td",null,[t("p",Pt,m(l(n).frais_retour),1)])])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(C,{class:"d-print-none"},{default:a(()=>[e(J,{modelValue:l(_),"onUpdate:modelValue":s[0]||(s[0]=i=>D(_)?_.value=i:null),grow:"",class:"disable-tab-transition",stacked:""},{default:a(()=>[(v(),y(Z,null,tt(U,(i,st)=>e($,{key:st},{default:a(()=>[e(ct,{size:"40",icon:i},null,8,["icon"])]),_:2},1024)),64))]),_:1},8,["modelValue"]),e(K,{modelValue:l(_),"onUpdate:modelValue":s[2]||(s[2]=i=>D(_)?_.value=i:null),class:"mt-3"},{default:a(()=>[e(k,null,{default:a(()=>[e(p,{id:l(n).id,"current-statut":l(n).statut,onGetItemData:s[1]||(s[1]=i=>u(l(n).id))},null,8,["id","current-statut"])]),_:1}),e(k,null,{default:a(()=>[e(O,{histories:l(n).histories},null,8,["histories"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(C,{class:"d-print-none"},{default:a(()=>[e(J,{modelValue:l(g),"onUpdate:modelValue":s[3]||(s[3]=i=>D(g)?g.value=i:null),grow:"",class:"disable-tab-transition",stacked:""},{default:a(()=>[e($,null,{default:a(()=>s[23]||(s[23]=[c(" Colis ")])),_:1}),e($,null,{default:a(()=>s[24]||(s[24]=[c(" ramassages ")])),_:1}),e($,null,{default:a(()=>s[25]||(s[25]=[c(" retours ")])),_:1})]),_:1},8,["modelValue"]),e(K,{modelValue:l(g),"onUpdate:modelValue":s[4]||(s[4]=i=>D(g)?g.value=i:null),class:"mt-3"},{default:a(()=>[e(k,null,{default:a(()=>[e(z,{headers:R,items:l(n).colis_livreur,"items-per-page":10},{"item.statut":a(({item:i})=>[e(F,A(("statutInfos"in o?o.statutInfos:l(x))(i.statut),{density:"default",label:"",size:"small"}),null,16),i.statut_retour?(v(),y("span",Gt,[s[26]||(s[26]=c(" - ")),e(F,A(("statutInfos"in o?o.statutInfos:l(x))(i.statut_retour),{density:"default",label:"",size:"small"}),null,16)])):G("",!0)]),"item.frais_livreur":a(({item:i})=>[i.statut=="REFUSE"?(v(),y("span",Ht,m(i.frais_livreur/2),1)):(v(),y("span",Wt,m(i.frais_livreur),1))]),_:1},8,["items"])]),_:1}),e(k,null,{default:a(()=>[e(z,{headers:r,items:l(n).ramassages_livreur,"items-per-page":10},{"item.statut":a(({item:i})=>[e(F,A(("statutInfos"in o?o.statutInfos:l(x))(i.statut),{density:"default",label:"",size:"small"}),null,16)]),_:1},8,["items"])]),_:1}),e(k,null,{default:a(()=>[e(z,{headers:d,items:l(n).retours_livreur,"items-per-page":10},{"item.statut":a(({item:i})=>[e(F,A(("statutInfos"in o?o.statutInfos:l(x))(i.statut),{density:"default",label:"",size:"small"}),null,16)]),_:1},8,["items"])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(f,{cols:"12",lg:"2",class:"d-print-none"},{default:a(()=>[e(T,null,{default:a(()=>[e(C,null,{default:a(()=>[e(M,{color:"info",class:"w-100",onClick:S},{default:a(()=>s[27]||(s[27]=[c(" Print ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])}}};export{we as default};
