import{s as F}from"./statutInfos-CQo4TYHA.js";import{P as Ce,_ as Te}from"./printRamassage-BikAH9yA.js";import{_ as Oe}from"./DialogCloseBtn-DVHO0sRD.js";import{V as we,_ as xe,c as De}from"./VDataTableServer-CKMds1xJ.js";import{d as Ue,_ as he,a as D,b as M,e as H,c as Pe}from"./constants-CSajaIPA.js";import{_ as $e}from"./AppTextField-CYZ3Rx27.js";import{_ as Le}from"./AppSelect-BVIOMXQR.js";import{_ as Be}from"./AppAutocomplete-C0T09cdS.js";import{r as n,A as U,aq as K,j as Ae,Y,a as Fe,c as J,o as i,b as l,f as d,m as v,e as s,d as Q,n as t,ak as r,v as y,x as R,s as X,ai as h,$ as Me}from"./index-BzYb6ZoD.js";import{$ as E}from"./VForm-BLjIjdGP.js";import{t as Z}from"./toast-D70_l16b.js";import{u as Re}from"./index-CEU2nq8s.js";import{V as ee}from"./VCardText-BXEBMitH.js";import{V as te,a as _}from"./VRow-DsbanFfo.js";import{a as ae,V as Ee}from"./VList-CRQHkd0E.js";import{V as le}from"./VDivider-BMPN5T29.js";import{V as Ne}from"./VSpacer-CEO0eUAf.js";import{V as je}from"./VMenu-BY9QwYHY.js";import{V as We}from"./VChip-BWDkMsrJ.js";import{V as Ge}from"./VDialog-G5cni5JA.js";import{V as se}from"./VCard-BFmSMYzL.js";import{s as qe}from"./VTabs-CQUVYkPt.js";import"./AppTextarea-DRNDIqPK.js";import"./VInput-DYDNzfTI.js";import"./VImg-D7Y9dL6k.js";import"./forwardRefs-DWGaNmQL.js";import"./VAlert-DtVA7brF.js";import"./VAvatar-BeI6oEr0.js";import"./VDataTable-DbMptXrw.js";import"./VSelect-CesdDUFt.js";import"./VTextField-CdQl9fbf.js";import"./VOverlay-XR8PqSnK.js";import"./filter-CU_3bWay.js";import"./VNodeRenderer-DxF3FeEK.js";import"./qrcode.vue.esm-BqCK7TRI.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css              */const ze={class:"d-flex flex-wrap gap-4 ma-6"},He={class:"d-flex gap-4 flex-wrap align-center"},Ke={key:1},Bt={__name:"list",async setup(Ye){let p,b;const P=n(!1),oe=n([{title:"Aujourd'hui",value:"today"},{title:"Hier",value:"yesterday"},{title:"La semaine dernière",value:"lastWeek"},{title:"Ce mois",value:"thisMonth"},{title:"Le mois précédent",value:"lastMonth"},{title:"Personnalisé",value:"custom"}]),ne=U("gestionnaire","action"),u=n(),m=n(),k=n("today"),N=()=>{const o=new Date;switch(P.value=k.value==="custom",k.value){case"today":u.value=o.toISOString().split("T")[0],m.value=o.toISOString().split("T")[0];break;case"yesterday":const e=D(o,-1);u.value=e.toISOString().split("T")[0],m.value=e.toISOString().split("T")[0];break;case"lastWeek":u.value=qe(D(o,-7)).toISOString().split("T")[0],m.value=Pe(D(o,-7)).toISOString().split("T")[0];break;case"thisMonth":u.value=M(o).toISOString().split("T")[0],m.value=H(o).toISOString().split("T")[0];break;case"lastMonth":const V=D(M(o),-1);u.value=M(V).toISOString().split("T")[0],m.value=H(V).toISOString().split("T")[0];break}};N();const S=n(),re=([p,b]=K(()=>E("/api/ramasseurs").then(o=>o.data)),p=await p,b(),p),ie=[{title:"code",key:"code",sortable:!1},{title:"Statut",key:"statut",sortable:!1},{title:"Livreur",key:"livreur",sortable:!1},{title:"Montant encaisse",key:"montant_encaisse",sortable:!1},{title:"Montant facturée",key:"montant_facture",sortable:!1},{title:"Frais Total",key:"frais_total",sortable:!1}],I=n(),C=n(),T=n(!1),c=n(!1),$=n(),O=n(!1),ue=n(),f=n(5),g=n(1),j=n(),W=n(),me=o=>{c.value=!0,$.value=o},de=async()=>{let o="/api/ramassage/"+$.value.id;T.value=!0,E({method:"DELETE",url:o}).then(async e=>{e.status===200&&(c.value=!1,Z.success(e.data),L()),T.value=!1}).catch(e=>{T.value=!1})},w=n(!1),pe=async()=>{let o="/api/generateLivreurFactures";w.value=!0,E({method:"POST",url:o}).then(async e=>{e.status===200&&(Z.success(e.data),L()),w.value=!1}).catch(e=>{w.value=!1})},ce=o=>{var e,V;j.value=(e=o.sortBy[0])==null?void 0:e.key,W.value=(V=o.sortBy[0])==null?void 0:V.order},{data:G,error:Je,statusCode:Qe,isFetching:fe,execute:L}=([p,b]=K(()=>Re(De("/api/factureLivreur",{query:{livreur_id:S,begin_date:u,end_date:m,code:I,statut:C,page:g,itemsPerPage:f,sortBy:j,orderBy:W}}))),p=await p,b(),p),ve=Ae(),ge=Y(()=>G.value.items),q=Y(()=>G.value.total),x=n(!1),Ve=n(0),ye=n(0);return(o,e)=>{const V=Be,B=Le,_e=$e,z=he,ke=Fe("IconBtn"),be=xe,Se=Oe,Ie=Te;return i(),J("div",null,[l(se,{title:"Filtres",class:"mb-6 d-print-none"},{default:s(()=>[l(ee,null,{default:s(()=>[l(te,null,{default:s(()=>[t(ne)?(i(),d(_,{key:0,cols:"12",sm:"3"},{default:s(()=>[l(V,{modelValue:t(S),"onUpdate:modelValue":e[0]||(e[0]=a=>r(S)?S.value=a:null),placeholder:"Livreurs",items:t(re),clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1})):v("",!0),l(_,{cols:"12",sm:"3"},{default:s(()=>[l(B,{modelValue:t(C),"onUpdate:modelValue":e[1]||(e[1]=a=>r(C)?C.value=a:null),placeholder:"Statut",items:t(Ue),clearable:"","clear-icon":"tabler-x"},{item:s(({item:a,props:A})=>[l(ae,X(A,{title:("statutInfos"in o?o.statutInfos:t(F))(a.value).text}),null,16,["title"])]),selection:s(({item:a})=>[y(R(("statutInfos"in o?o.statutInfos:t(F))(a.value).text),1)]),_:1},8,["modelValue","items"])]),_:1}),l(_,{cols:"12",sm:"2"},{default:s(()=>[l(_e,{modelValue:t(I),"onUpdate:modelValue":e[2]||(e[2]=a=>r(I)?I.value=a:null),placeholder:"Code"},null,8,["modelValue"])]),_:1})]),_:1}),l(te,null,{default:s(()=>[l(_,{cols:"12",sm:"3"},{default:s(()=>[l(B,{modelValue:t(k),"onUpdate:modelValue":[e[3]||(e[3]=a=>r(k)?k.value=a:null),N],placeholder:"Plage de dates",items:t(oe),label:t(u)+" - "+t(m)},null,8,["modelValue","items","label"])]),_:1}),t(P)?(i(),d(_,{key:0,cols:"12",sm:"3"},{default:s(()=>[l(z,{modelValue:t(u),"onUpdate:modelValue":e[4]||(e[4]=a=>r(u)?u.value=a:null),label:"Début",placeholder:"date"},null,8,["modelValue"])]),_:1})):v("",!0),t(P)?(i(),d(_,{key:1,cols:"12",sm:"3"},{default:s(()=>[l(z,{modelValue:t(m),"onUpdate:modelValue":e[5]||(e[5]=a=>r(m)?m.value=a:null),label:"Fin",placeholder:"date"},null,8,["modelValue"])]),_:1})):v("",!0)]),_:1})]),_:1}),l(le),Q("div",ze,[l(Ne),Q("div",He,[l(B,{modelValue:t(f),"onUpdate:modelValue":e[6]||(e[6]=a=>r(f)?f.value=a:null),items:[5,10,20,25,50]},null,8,["modelValue"]),t(U)("create","factureLivreur")?(i(),d(h,{key:0,color:"primary","prepend-icon":"tabler-plus",loading:t(w),onClick:pe},{default:s(()=>e[15]||(e[15]=[y(" Génerer les factures ")])),_:1},8,["loading"])):v("",!0)])]),l(le,{class:"mt-4"}),l(we,{"items-per-page":t(f),"onUpdate:itemsPerPage":e[8]||(e[8]=a=>r(f)?f.value=a:null),page:t(g),"onUpdate:page":e[9]||(e[9]=a=>r(g)?g.value=a:null),loading:t(fe),headers:ie,items:t(ge),"items-length":t(q),class:"text-no-wrap",locale:"fr","onUpdate:options":ce},{"item.code":s(({item:a})=>[t(U)("show","factureLivreur")?(i(),d(h,{key:0,variant:"text",onClick:A=>t(ve).push("/factureLivreur/"+a.id)},{default:s(()=>[y(R(a.code),1)]),_:2},1032,["onClick"])):(i(),J("span",Ke,R(a.code),1))]),"item.statut":s(({item:a})=>[l(We,X(("statutInfos"in o?o.statutInfos:t(F))(a.statut),{density:"default",label:"",size:"small"}),null,16)]),"item.actions":s(({item:a})=>[a.statut=="EN_ATTENTE"?(i(),d(ke,{key:0},{default:s(()=>[l(Me,{icon:"tabler-dots-vertical"}),l(je,{activator:"parent"},{default:s(()=>[l(Ee,null,{default:s(()=>[t(U)("delete","ramassage")?(i(),d(ae,{key:0,value:"delete","prepend-icon":"tabler-trash",onClick:A=>me(a)},{default:s(()=>e[16]||(e[16]=[y(" Delete ")])),_:2},1032,["onClick"])):v("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)):v("",!0)]),bottom:s(()=>[l(be,{page:t(g),"onUpdate:page":e[7]||(e[7]=a=>r(g)?g.value=a:null),"items-per-page":t(f),"total-items":t(q)},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","page","loading","items","items-length"]),l(Ge,{modelValue:t(c),"onUpdate:modelValue":e[12]||(e[12]=a=>r(c)?c.value=a:null),persistent:"",class:"v-dialog-sm"},{default:s(()=>[l(Se,{onClick:e[10]||(e[10]=a=>c.value=!t(c))}),l(se,{title:"Êtes-vous sûr de vouloir supprimer le ramassage "+t($).code+" ?"},{default:s(()=>[l(ee,{class:"d-flex justify-end gap-3 flex-wrap"},{default:s(()=>[l(h,{color:"secondary",variant:"tonal",onClick:e[11]||(e[11]=a=>c.value=!1)},{default:s(()=>e[17]||(e[17]=[y(" Non ")])),_:1}),l(h,{loading:t(T),onClick:de},{default:s(()=>e[18]||(e[18]=[y(" Oui ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])]),_:1}),t(O)?(i(),d(Ce,{key:0,"is-print-ramassage":t(O),"onUpdate:isPrintRamassage":e[13]||(e[13]=a=>r(O)?O.value=a:null),item:t(ue)},null,8,["is-print-ramassage","item"])):v("",!0),t(x)?(i(),d(Ie,{id:t(ye),key:t(Ve),"is-show-item":t(x),"onUpdate:isShowItem":e[14]||(e[14]=a=>r(x)?x.value=a:null),onFetchItems:t(L)},null,8,["id","is-show-item","onFetchItems"])):v("",!0)])}}};export{Bt as default};
